<script type="text/ng-template" id="alarmTypeahead.html">
   <a>
        <span ng-bind="match.model.name"></span>
   </a>
</script>
<div ng-controller="AlarmSettingController">
    <div class="wrapper-md1">
        <div class="col-sm-3">
            <div class="panel panel-default">
                <div class="panel-heading"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;Add Alarm setting</div>
                <div class="panel-body">
                    <form class="form-horizontal form-validation">
                        <input type="hidden" ng-model="id"  />                        
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div><p>Alarm Name</p></div>
                                <div>
                                    <tags-input ng-model="alarm_name_list" ng-if="show_alarm_list"  placeholder="Add Alarm" display-property="name" replace-spaces-with-dashes="false" style="margin-top:-5px;font-size:12px;">
                                        <auto-complete source="loadFiltersAlarm($query)" min-length="0" debounce-delay="0" load-on-focus="true" load-on-empty="true"
                                        max-results-to-show="100">
                                        </auto-complete>
                                    </tags-input>    

                                     <input type="text" ng-model="alarm_name" ng-if="show_alarm"  class="form-control input-sm"  class="form-control  input-sm"
                                       uib-popover="" popover-trigger="mouseenter" popover-placement="right"
                                       uib-typeahead="alarmgroup.name for alarmgroup in getAlarmGroupList($viewValue)"
                                       typeahead-min-length="0" typeahead-on-select="onGroupSelect($item, $model, $label)" required>
                                </div>
                            </div>
                        </div>
                        <div class="h-divider"> </div>
                            <div class="form-group mb-0" >
                                <div class="col-sm-2">
                                    <p>                                        
                                        <label class="i-switch">
                                            <input type="checkbox" ng-model="trigger1_flag" ng-click="viewTrigger(1)" checked >
                                            <i></i>
                                        </label>
                                    </p>
                                </div>
                                <div class="col-sm-6">
                                    <p>
                                        Ack Based  Escalation
                                    </p>
                                </div>                                
                            </div>
                            <div class="form-group mb-0" >
                                <div class="col-sm-2">
                                    <p>                                        
                                        <label class="i-switch">
                                            <input type="checkbox" ng-model="trigger2_flag" ng-click="viewTrigger(2)" checked >
                                            <i></i>
                                        </label>
                                    </p>
                                </div>
                                <div class="col-sm-6">
                                    <p>
                                        Status Based Escalation
                                    </p>
                                </div>                                
                            </div>
                        <div class="h-divider" ng-if="trigger1_flag == true"> </div>
                        <div class="form-group" ng-hide="true" >
                             <div class="col-sm-12">
                                <p>Ack Based  Escalation</p>
                             </div>   
                        </div>
                        <div class="form-group" ng-if="trigger1_flag == true" >
                            <!--
                            <div class="col-sm-4">
                                <label class="text-muted">Action</label>
                                <label style="color:#F44336">*</label>   
                                <select  class='form-control' ng-model="trigger1_action">                                 
                                    <option value="IVR" selected>IVR</option>
                                    <option value="GROUP">Send message to different group</option>
                                    <option value="REPEAT">Repeat message</option>                                    
                                </select>                
                            </div>
                            -->
                            <div class="col-sm-4">
                                <label class="text-muted">Action Type </label>
						        <div ng-dropdown-multiselect="" options="actiontypes" selected-model="trigger1_action_types" 
                                    checkboxes="true" extra-settings="actiontypes_hint_setting" 
                                    translation-texts="actiontypes_hint">
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label class="text-muted">Percent(%)</label>
                                <!--<label style="color:#F44336">*</label>-->
                                <input  ng-model="set.percent" class="form-control  input-sm" required/>                
                            </div>
                            <div class="col-sm-4">
                                <label class="text-muted">Time(mins)</label>
                                <!--<label style="color:#F44336">*</label>-->   
                                <input ng-model="set.trigger1_time" class="form-control  input-sm" required/>                
                            </div>
                        </div>
                        <!--
                        <div class="form-group" >                             
                                                      
                            <div class="col-sm-6"> 
                               <label class="text-muted">Flag</label>
                               <label style="color:#F44336">*</label>
                               <div class="">                                
                                    <label class="i-switch m-t-xs m-r">
                                        <input type="checkbox" ng-model="trigger1_flag" checked >
                                        <i></i>
                                    </label>
                               </div>                                
                            </div>                            
                        </div>
                        -->
                        <div class="form-group" ng-if="trigger1_flag == true" >                                                    
                            <div class="col-sm-6"> 
                               <label class="text-muted">Notify Same Group</label>
                               <!--<label style="color:#F44336">*</label>-->                               
                            </div>
                            <div class="col-sm-6"> 
                               <div class="">                                
                                    <label class="i-switch">
                                        <input type="checkbox" ng-model="trigger1_sg_flag" ng-click="viewSameGroup()"  checked >
                                        <i></i>
                                    </label>
                               </div>
                            </div>
                        </div>
                        <div class="form-group" ng-if="trigger1_flag == true && trigger1_sg_flag == true"  >                                                    
                            <div class="col-sm-6"> 
                               <label class="text-muted">Notify UnAck Users</label>
                               <!--<label style="color:#F44336">*</label>-->
                            </div>
                            <div class="col-sm-6">                                
                               <div class="">                                
                                    <label class="i-switch">
                                        <input type="checkbox" ng-model="trigger1_unack_flag" ng-click="viewSameUnack()" checked >
                                        <i></i>
                                    </label>
                               </div>
                            </div>
                        </div>

                        <div class="form-group" ng-if="trigger1_flag == true && trigger1_sg_flag == false" >
                            <div class="col-sm-12">
                                <div>
                                    <p>User list</p>
                                </div>
                                <div>                                   
                                    <tags-input ng-model="user_name_list" placeholder="Enter User" display-property="wholename" replace-spaces-with-dashes="false" style="margin-top: -5px; font-size:12px;">
                                        <auto-complete source="loadFiltersUser($query)" min-length="0" debounce-delay="0" load-on-focus="true" load-on-empty="true"
                                            max-results-to-show="100">
                                        </auto-complete>
                                    </tags-input>                    
                                </div>
                            </div>	                           
                        </div>
                         
                        <div class="h-divider" ng-if="trigger2_flag == true" > </div>
                        <div class="form-group" ng-hide="true" >
                            <div class="col-sm-12" >
                                <p>Status Based Escalation</p>
                            </div>
                        </div>
                        <div class="form-group" ng-if="trigger2_flag == true" >
                            <div class="col-sm-6">
                                <!--
                                <label class="text-muted">Action</label>
                                <label style="color:#F44336">*</label>   
                                <select  class='form-control' ng-model="trigger2_action">                                                                     
                                    <option value="IVR" selected >IVR</option>
                                    <option value="GROUP">Send message to different group</option>
                                    <option value="REPEAT">Repeat message</option>                                    
                                </select>                
                                -->
                                <label class="text-muted">Action Type </label>
						        <div ng-dropdown-multiselect="" options="actiontypes" selected-model="trigger2_action_types" 
                                    checkboxes="true" extra-settings="actiontypes_hint_setting" 
                                    translation-texts="actiontypes_hint">
                                </div>
                            </div>
                           <div class="col-sm-6">
                                <label class="text-muted">Time(mins)</label>
                                <label style="color:#F44336">*</label>   
                                <input ng-model="set.trigger2_time" class="form-control  input-sm" required/>                
                            </div>
                        </div>
                        <!--
                        <div class="form-group" >                                                        
                            <div class="col-sm-6"> 
                               <label class="text-muted">Flag</label>
                               <label style="color:#F44336">*</label>    
                               <div class="">                                
                                    <label class="i-switch m-t-xs m-r">
                                        <input type="checkbox" ng-model="trigger2_flag" checked >
                                        <i></i>
                                    </label>
                               </div>
                            </div>
                        </div>
                        -->
                        <div class="h-divider"> </div>
                        <div class="form-group" >                                                    
                            <div class="col-sm-6"> 
                               <label class="text-muted">Retry escalation</label>
                               <!--<label style="color:#F44336">*</label>-->                               
                            </div>
                            <div class="col-sm-6"> 
                               <div class="">                                
                                    <label class="i-switch">
                                        <input type="checkbox" ng-model="trigger1_retry_flag" checked >
                                        <i></i>
                                    </label>
                               </div>
                            </div>
                        </div>
                        <div class="form-group" >                            
                            <div class="col-sm-6">
                                <label class="text-muted">Duration(mins)</label>
                                <!--<label style="color:#F44336">*</label>-->   
                                <input ng-model="set.trigger1_duration" class="form-control  input-sm" required/>                
                            </div>

                            <div class="col-sm-6"> 
                               <label class="text-muted">Number retries</label>
                               <!--<label style="color:#F44336">*</label>-->
                               <input ng-model="set.trigger1_loop" class="form-control  input-sm" required/>                
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-12">
	                            <div class="pull-right">
					                        <button type="submit" class="btn btn-sm btn-dark text-uc m-t-n-xs" ng-click="alarmSettingAdd()"><strong>
					                        	<span class="text-success">{{action_button}}</span></strong></button>
					                        <button type="submit" class="btn btn-sm btn-dark text-uc m-t-n-xs" ng-click="alarmCancel()"><strong>
					                        	<span class="text-danger">Clear</span></strong></button>
					            </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>      

        <div class="col-sm-9">
            <div class="panel panel-default">
                <div class="panel-heading"><i class="fa fa-list-ul" aria-hidden="true"></i>&nbsp;Group List</div>
                <div class="panel-body">
                    <div class="row">
                        <table  st-table="datalist"  st-pipe="getDataList" style="table-layout: fixed" class="table ticket table-hover table-condensed b-t b-light" >
                            <thead class="tblhead-sm" style="font-size: .8vw">
                            <tr  class="text-center">
                                <th><b>Alarm Name</b></th>
                                <th><b>Ack Action</b></th>
                                <th><b>Percent (%)</b></th>
                                <th><b>Ack T(mins)</b></th>
                                <th><b>Ack Enable</b></th> 
                                <th><b>Same Group</b></th>                                
                                <th><b>Unack</b></th>                                  
                                <th><b>Status Action</b></th>
                                <th><b>Status T(mins)</b></th>
                                <th><b>Status Enable</b></th>
                                <th><b>Duration (mins)</b></th>
                                <th><b>Retries</b></th>
                                <th style="width: 80px"><b>Action</b></th>
                            </tr>
                            </thead>
                            <tbody  ng-hide="isLoading" ng-repeat="row in datalist">
                                <tr class="text-center">
                                    <td align = "left">
                                        {{row.alarm_name}}
                                    </td>
                                    <td align = "left">{{row.trigger1_action}}</td>
                                    <td >{{row.percent}}</td>
                                    <td >{{row.trigger1_time}}</td>
                                    <td > <label class="m-t-xs m-r" ng-if="row.trigger1_flag == 1">
                                           enable
                                          </label>
                                          <label class="m-t-xs m-r" ng-if="row.trigger1_flag == 0">
                                            disable
                                          </label>
                                    </td>
                                    <td > <label class="m-t-xs m-r" ng-if="row.trigger1_sg_flag == 1">
                                            enable
                                          </label>
                                          <label class="m-t-xs m-r" ng-if="row.trigger1_sg_flag == 0">
                                            disable
                                          </label>
                                    </td>
                                    <td > <label class="m-t-xs m-r" ng-if="row.trigger1_unack_flag == 1">
                                            enable
                                          </label>
                                          <label class="m-t-xs m-r" ng-if="row.trigger1_unack_flag == 0">
                                            disable
                                          </label>
                                    </td>                                    
                                    <td align = "left">{{row.trigger2_action}}</td>
                                    <td >{{row.trigger2_time}}</td>
                                    <td > <label class="m-t-xs m-r" ng-if="row.trigger2_flag == 1">
                                            enable
                                          </label>
                                          <label class="m-t-xs m-r" ng-if="row.trigger2_flag == 0">
                                            disable
                                          </label></td>
                                    <td >{{row.trigger1_duration}}</td>
                                    <td >{{row.trigger1_loop}}</td>                                                
                                    <td >
                                        <a class="btn default btn-xs green" ng-click="editItems(row)">
                                            <i class="fa fa-pencil"></i></a>
                                        <a class="btn default btn-xs red" ng-click="deleteItem(row)">
                                            <i class="fa fa-times"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                                
                            <tbody ng-show="isLoading">
                                <tr>
                                    <td colspan="4" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                </tr>
                            </tbody>
                            <tfoot ng-hide="isLoading">
                                <tr ng-show="paginationOptions.totalItems > paginationOptions.pageSize">
                                    <td colspan="4" class="text-center">
                                        <div st-pagination="" st-items-by-page="paginationOptions.pageSize" st-displayed-pages="7" class="no-margin"></div>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>                   
                </div>
            </div>
        </div>
    </div>
</div>
