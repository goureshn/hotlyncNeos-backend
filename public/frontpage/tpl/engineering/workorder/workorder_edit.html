<style>
    button {
        pointer: cursor;
    }

    input[type=file] {
        width: 150px;
        height: 20px;
    }
    .tbl-sm {
        font-size: .8vw;
        padding: 1px 15px !important;
        color: #67686a;
    }
</style>
<script type="text/ng-template" id="locationTypeahead.html">
    <a>
        <span ng-bind="match.model.name"></span><br>
        <span style="font-size: 10px" ng-bind="match.model.type"></span><br>
    </a>
</script>
<script type="text/ng-template" id="staffTypeahead.html">
    <a>
        <span ng-bind="match.model.name"></span><br>
        <span style="font-size: 10px" ng-bind="match.model.label"></span><br>
    </a>
</script>
<script type="text/ng-template" id="equipmentTypeahead.html">
    <a>
        <span style="font-size: 12px" ng-bind="match.model.name"></span><br>
        <span style="font-size: 10px" ng-bind="match.model.equip_id"></span><br>
        <span style="font-size: 10px" ng-bind="match.model.location_name"></span>- <span style="font-size: 10px" ng-bind="match.model.location_type"></span><br>
    </a>
</script>

<form class="form-horizontal form-validation" ng-submit="updateWorkorder()">
    <div class="modal-content">        
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="cancelWorkorder()">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            </button>
            <h3 class="modal-title" style="color:#2691d9" id="Heading">{{workorder.ticket_id}} Edit</h3>
        </div>        
        <div class="modal-body" fill-height additional-padding="200">   
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Name</label>
                <div class="col-sm-9 scrollable-dropdown-menu">
                    <input class="form-control input-sm"  ng-model="workorder.name"  required
                        popover-trigger="mouseenter" ng-readonly="view_property"  />
                </div>
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Asset</label>
                <div class="col-sm-9 scrollable-dropdown-menu">
                    <input class="form-control input-sm col-sm-11" type="text" ng-model="workorder.equipment_name" ng-readonly="view_property"
                        popover-trigger="mouseenter"
                        uib-typeahead="group.name for group in equipment_list | filter:$viewValue | limitTo:10"
                        typeahead-min-length="0"
                        typeahead-on-select="onEquipmentSelect(workorder, $item, $model, $label)"
                        typeahead-template-url="equipmentTypeahead.html">

                </div>
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Asset ID</label>
                <div class="col-sm-9">
                    <input type="text" ng-model="workorder.eq_id" class="form-control input-sm" disabled>
                </div>
            </div>  
            <!--
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Location</label>
                <div class="col-sm-9 scrollable-dropdown-menu">
                    {{workorder.location_name}}
                    <label ng-if="workorder.location_name"> : </label>
                    {{workorder.location_type}}
                </div>
            </div>
        -->
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Location</label>
                <div class="col-sm-9">
                    <input type="text" ng-model="workorder.location_name" class="form-control input-sm" disabled>
                </div>
            </div>  
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Location Type</label>
                <div class="col-sm-9">
                    <input type="text" ng-model="workorder.location_type" class="form-control input-sm" disabled>
                </div>
            </div>  
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Type</label>
                <div class="col-sm-9">
                    <select  class='form-control' ng-model="workorder.work_order_type" ng-disabled="view_property"
                            ng-options="type for type in work_order_types">
                    </select>
                </div>
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Priority</label>
                <div class="col-sm-9 scrollable-dropdown-menu">                        
                    <div class="btn-group">
                        <label class="btn btn-primary" ng-model="workorder.priority" ng-repeat="row in prioritys" uib-btn-radio="row">{{row}}</label>                            
                    </div>        
                </div>
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Description</label>
                <div class="col-sm-9">
                    <textarea class="form-control input-sm" rows="3" ng-model="workorder.description"
                            style="resize:none"  popover-trigger="mouseenter" ng-readonly="view_property" ></textarea>
                </div>
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Checklist</label>
                <div class="col-sm-9 scrollable-dropdown-menu">
                    <input type="text" ng-model="workorder.checklist_name" class="form-control input-sm" ng-readonly="workorder.status == 'Completed'"
                        popover-trigger="mouseenter" popover-placement="top"
                        uib-typeahead="checklist.name for checklist in getCheckList($viewValue)"
                        typeahead-min-length="0"                        
                        typeahead-on-select="onChecklistSelect(workorder, $item, $model, $label)">

                    <label class="md-check" style="margin-top: 5px" ng-show="workorder.checklist_id > 0">
                        <input type="checkbox" ng-model="workorder.inspected" disabled>
                        <i class="blue"></i>
                        Inspected
                    </label>    
                    <a ng-show="workorder.checklist_id > 0" class="btn default btn-xs" style="margin-top: -5px" ng-click="onViewCheckList()">                        
                        &nbsp; <img style="width: 15px;height: 15px" src="/images/eng/checklist.svg"/>
                    </a>
                </div>
            </div>
            
            <div class="form-group" style="margin-right: 0px" ng-hide="workorder.status == 'Pending'">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Start Date</label>
                <div class="col-sm-9" style="padding-top: 7px">
                    {{workorder.purpose_start_date | mydatetime}}
                </div>
            </div>
            <div class="form-group" style="margin-right: 0px" ng-show="workorder.status == 'Completed'">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">End Date</label>
                <div class="col-sm-9" style="padding-top: 7px">
                    {{workorder.end_date | mydatetime}}
                </div>
            </div>     

            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Estimated</label>
                <div class="col-sm-9">
                    <input type="text" ng-model="workorder.estimated_duration" class="form-control input-sm" ng-readonly="workorder.status == 'Completed'">
                </div>
            </div>

            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Schedule Date</label>
                <div class="col-sm-9">
                    <a class="dropdown-toggle" id="dropdown4" role="button" data-toggle="dropdown" data-target="#">
                        <div class="input-group">
                            <input type="text" class="form-control" ng-model="workorder.schedule_date" ng-disabled="workorder.status != 'Pending'"/>
                            <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                        </div>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                        <datetimepicker ng-model="datetime.schedule_date" ng-disabled="workorder.status != 'Pending'"
                                        data-datetimepicker-config="{ dropdownSelector: '#dropdown2' }"
                                        data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)"/>
                    </ul>
                </div>
            </div>

            <div  class="form-group" ng-if="workorder.staff_group.length > 0 " >
                <div class="col-sm-12">
                    <table  class="table ticket"  >
                        <thead class="tblhead-sm" style="background: #e7e8eb;color: #0a0a0a">
                        <tr>
                            <th><b>No</b></th>
                            <th><b>Staff</b></th>
                            <th><b>Type</b></th>
                            <th><b>Cost</b></th>
                            <th style="width: 20px"><b>Action</b></th>
                        </tr>
                        </thead>
                        <tbody ng-hide="isLoading" ng-repeat="row in workorder.staff_group">
                        <tr>
                            <td class="tbl-sm">
                                {{$index+1}}
                            </td>
                            <td class="tbl-sm">{{row.staff_name}}</td>
                            <td class="tbl-sm">{{row.staff_type}}</td>
                            <td class="tbl-sm">{{row.staff_cost}}</td>
                            <td class="tbl-sm">
                                <a class="btn default btn-xs" style="background: #d9dadc" ng-click="deleteStaffs(row.staff_id)">
                                    <i class="fa fa-times"></i></a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>    
            </div>
            
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Staff/Group</label>
                <div class="col-sm-4 scrollable-dropdown-menu" >
                    <input class="form-control input-sm col-sm-11" type="text" ng-model="workorder.staff_name"
                        popover-trigger="mouseenter" popover-placement="top"
                        uib-typeahead="staff.name for staff in staff_list | filter:$viewValue | limitTo:10"
                        typeahead-min-length="0"
                        typeahead-template-url="staffTypeahead.html"
                        typeahead-on-select="onStaffSelect(workorder, $item, $model, $label)">

                </div>
                <div class="col-sm-4" style="padding-top:5px;" >
                    {{workorder.staff_cost}}
                </div>
                <div class="col-sm-1" >                                
                    <i class="fa fa-plus-circle fa-2x text-danger " style="cursor: pointer" title="Create Staff" ng-click="CreateStaffs()"></i>
                </div>
            </div>

            <div  class="form-group" ng-if="workorder.part_group.length > 0 " >
                <div class="col-sm-12">
                    <table  st-table="datalist"  st-pipe="getPartGroupList" class="table ticket"  >
                        <thead class="tblhead-sm" style="background: #e7e8eb;color: #0a0a0a">
                        <tr>
                            <th><b>No</b></th>
                            <th><b>Parts</b></th>
                            <th><b>Count</b></th>
                            <th><b>Cost</b></th>
                            <th style="width: 20px"><b>Action</b></th>
                        </tr>
                        </thead>
                        <tbody ng-hide="isLoading" ng-repeat="row in workorder.part_group">
                        <tr>
                            <td class="tbl-sm">
                                {{$index+1}}
                            </td>
                            <td class="tbl-sm">{{row.part_name}}</td>
                            <td class="tbl-sm">{{row.part_number}}</td>
                            <td class="tbl-sm">{{row.part_cost}}</td>
                            <td class="tbl-sm">
                                <a class="btn default btn-xs" style="background: #d9dadc" ng-click="deleteParts(row.part_id)">
                                    <i class="fa fa-times"></i></a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>    
            </div>
            <div class="form-group" style="margin-right: 0px">
                <label class="col-sm-3 text-right control-label text-muted" style="margin-bottom: 0px">Parts</label>
                <div class="col-sm-4 scrollable-dropdown-menu">
                    <input class="form-control input-sm col-sm-12" type="text" ng-model="workorder.part_name"
                        popover-trigger="mouseenter"
                        uib-typeahead="group.name for group in getPartList($viewValue)"
                        typeahead-min-length="0"
                        typeahead-on-select="onPartelect(workorder, $item, $model, $label)">
                </div>
                <div class="col-sm-1" style="padding-top:5px;" >
                    {{workorder.part_stock}}
                </div>
                <div class="col-sm-3" >
                    <input class="form-control input-sm" type="number" data-ng-model="workorder.part_number"
                        popover-trigger="mouseenter" popover-placement="top" />
                </div>
                <div class="col-sm-1">
                    <i class="fa fa-plus-circle fa-2x text-danger " style="cursor: pointer" title="Create Parts" ng-click="CreateParts()"></i>
                </div>
            </div>

            <div class="form-group" style="margin-right: 0px">
                <div class="col-sm-4 control-label">          
                    <button class="btn btn-dark btn-sm" ngf-select="uploadFiles($files)" multiple ngf-max-files="5"
                        ngf-max-size="10MB" ngf-accept="'image/*,application/pdf'"
                        ngf-pattern="'image/*,application/pdf'" ngf-capture="'camera'"
                        >
                        <span class="text-success font-bold"><i class="fa fa-upload"></i>&nbsp;Select Files</span></button>
                </div>
                <div class="col-sm-8 ">
                    <ul>
                        <li ng-repeat="f in workorder.filelist" style="font:smaller">
                            <i class="fa fa-minus-circle text-danger " style="cursor: pointer"  ng-click="deletefile(f)"></i> <span ng-click="openModalImage(f.path, f.filename)"> {{f.filename}} </span>
                        </li>
                    </ul>                      
                </div>  
            </div>
        </div>

        <div class="modal-footer ">
            <button type="submit" class="btn btn-info btn-sm w-xs" data-dismiss="modal">
                <span class="glyphicon glyphicon-ok"></span>
                <b> Update</b>
            </button>
            <button type="button" class="btn btn-default btn-sm w-xs" data-dismiss="modal" ng-click="cancelWorkorder()">
                <span class="glyphicon glyphicon-remove"></span>
                <b> Cancel</b>
            </button>
        </div>

    </div>
</form>
