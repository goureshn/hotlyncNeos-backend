<div ng-controller="AgentChatController">
	<div class="col-sm-3" style="padding: 0">
		<md-content class="call_menu navi clearfix">
			<md-tabs md-selected="selectedIndex"  md-disable-animation md-autoselect md-dynamic-height md-border-bottom style="height:30px;">
				<md-tab md-disable-animation style="margin:8px -5px 0;" class="{{active == 1 ? 'tab-current' : ''}}">
					<md-tab-label>
						&nbsp;&nbsp;Users
					</md-tab-label>

					<md-tab-body>
						<div class="panel-body" style="padding: 5px">
							<form class="form-horizontal">
								<div class="form-group">
									<div class="pull-left">
										<label style="margin-left: 18px; margin-top: 5px">
											&nbsp;<b>Online User</b>
										</label>
									</div>
									<div class="pull-left" style="margin-left: 20px">
										<label class="i-switch m-t-xs m-r"  >
											<input type="checkbox" ng-model="filter.online_flag" ng-change="onChangeOnline(online_flag)" >
											<i></i>
										</label>
									</div>
								</div>

								<div class="form-group">
									<div class="col-sm-12">
										<div class="input-group">
											<input type="text" class="form-control" ng-model="filter.agent_name" ng-keyup="$event.keyCode == 13 && onSearchAgent()" />
											<span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="onSearchAgent()"><i class="fa fa-search"></i></button>
                                    </span>
										</div>
									</div>
								</div>
							</form>
							<div class="list-group" style="margin-bottom: 5px"
								 fill-height additional-padding="180">
								<ul class="list-group no-bg no-borders">
									<li class="list-group-item" ng-repeat="item in agent_list" ng-class="{'active': item.id == agent.id}" ng-click="onSelectAgent(item)">
										<a herf class="pull-left thumb-sm avatar m-r">
											<img ng-src="{{item.picture}}" alt="..." class="img-circle">
											<i class="on b-white bottom" ng-class="{'on' : item.online_status == 1, 'off' : item.online_status != 1}"></i>
										</a>
										<div class="clear">
											<div><a href>{{item.agent_name}}</a></div>
											<small class="text-muted">{{item.job_role}}</small>
										</div>
									</li>
								</ul>
							</div>
						</div>
					</md-tab-body>
				</md-tab>

				<md-tab style="margin:8px -5px 0px;">
					<md-tab-label>&nbsp;
						Chats
					</md-tab-label>

					<md-tab-body>
						<form class="form-horizontal">
							<div class="form-group">
								<div class="col-sm-12">
									<div class="input-group">
										<input type="text" class="form-control" ng-model="attendant_name" ng-keyup="$event.keyCode == 13 && searchStaff()" />
										<span class="input-group-btn">
                                        <button type="button" class="btn btn-default" ng-click="searchStaff()"><i class="fa fa-search"></i></button>
                                    </span>
									</div>
								</div>
							</div>
						</form>
						<div class="list-group" style="margin-bottom: 5px"
							 fill-height additional-padding="180">
							<ul class="list-group no-bg no-borders">
								<li class="list-group-item" ng-repeat="item in conversation_list" ng-class="{'active': item.to_id == agent.id}" ng-click="onSelectConversation(item)">
									<a herf class="pull-left thumb-sm avatar m-r">
										<img ng-src="{{item.to_picture}}" alt="..." class="img-circle">
										<i class="on b-white bottom" ng-class="{'on' : item.online_status == 1, 'off' : item.online_status != 1}"></i>
										<span ng-if="item.unread_cnt > 0" class="badge badge-sm up bg-danger pull-right-xs" >{{item.unread_cnt}}</span>
									</a>
									<div class="clear">
										<div><a href>{{item.to_name}}</a></div>
										<small class="text-muted">{{item.text}}</small>
									</div>
								</li>
							</ul>
						</div>
					</md-tab-body>
				</md-tab>
			</md-tabs>
		</md-content>

	</div>
	<div class="col-sm-9" style="padding: 0px">
		<div class="panel panel-default">
		    <div class="panel-heading">
		    	<label class="text-sm font-bold"><i class="fa fa-comment text-default"></i>&nbsp;&nbsp;{{agent.agent_name}}
		    		<span class="label m-l-sm"
		    			ng-class="{
		    				'bg-wakeup-success': agent.online_status==1,
		    				'bg-wakeup-canceled': agent.online_status!=1,
		    				}"
		    			>
		    	  		{{agent.online_status==1 ? 'Online' : 'Offline'}}
		    	  	</span>
		    	</label>
		    	<div class="pull-right">
		    		{{current_session.typing_flag == 0 ? 'Typing...' : ''}}
		    	</div>
		    </div>
		    <div class="panel-body" fill-height additional-padding="180" scroll-glue keep-scroll scrollytop="loadMore()">

				<div class="m-b" scroll-item ng-repeat="msg in messages">
			        <a ng-if="msg.direction == 0" herf class="pull-left thumb-sm avatar m-r" style="margin-top: 0px">
	            		<img ng-src="{{msg.to_picture}}" alt="..." class="img-circle">
	            	  	<i class="on b-white bottom" ng-class="{'on' : msg.online_status == 1, 'off' : msg.online_status != 1}"></i>
	            	</a>

			        <!-- incoming -->
			        <div class="m-l-xxl" style="margin-left: 60px; max-width:90%" ng-if="msg.direction == 0">
			        	<!-- Text -->
			        	<div class="pos-rlt wrapper b b-light bg-info r r-2x" ng-if="msg.type == 1">
			        	  	<span class="arrow left pull-up arrow-info"></span>
			        	  	<p class="m-b-none chat" dynamic="msg.text"></p>
			        	</div>
			        	<!-- Image -->
			        	<div class="r r-2x" ng-if="msg.type == 2">
			        		<img ng-src="{{msg.path}}" img-orientation style="max-width: 200px; max-height: 200px" ng-click="onShowImage(msg)"/>
			        	</div>
			        	<p class="m-b-none chat" ng-if="msg.type > 1">
			        		<a href="{{msg.path}}">
			        			<i class="fa fa-file-pdf-o" style="font-size: 20px; color:red" title="Summary PDF download" ng-if="msg.type == 3"></i>&nbsp;{{msg.text}}
			        		</a>
			        	</p>
			        	<small class="text-muted"><i class="fa fa-ok text-success"></i>{{ msg.created_at | mydate: "h:mm a" }}</small>
			        </div>
			        <!-- outgoing -->
			        <div ng-if="msg.direction == 1" style="margin-left:10%;">
			        	<div style="text-align: right;">
			        		<label class="font-bold">
			        			<a class="text-sm ng-binding">
			        			  	<i class="fa fa-user text-primary"></i>
			        			  &nbsp;{{agent_id == msg.from_id ? 'Me' : msg.agent_name}}
			        			</a>
			        		</label>
			        	</div>
			        	<!-- Text -->
			        	<div class="pos-rlt wrapper bg-primary r r-2x" ng-if="msg.type == 1">
			        	  	<span class="arrow right pull-up arrow-primary"></span>
			        	 	 <p class="m-b-none" dynamic="msg.text"></p>
			        	</div>
			        	<small class="text-muted" ng-if="msg.type == 1">{{ msg.created_at | mydate: "h:mm a" }}</small>
			        	<!-- Image -->
			        	<div class="r r-2x" ng-if="msg.type == 2" style="text-align: right">
			        		<img ng-src="{{msg.path}}" img-orientation style="max-width: 200px; max-height: 200px" ng-click="onShowImage(msg)"/>
			        	</div>
			        	<p class="m-b-none chat" style="text-align: right" ng-if="msg.type > 1">
			        		<a href="{{msg.path}}">
			        			<i class="fa fa-file-pdf-o" style="font-size: 20px; color:red" title="Summary PDF download" ng-if="msg.type == 3"></i>&nbsp;{{msg.text}}
			        		</a>
			        	</p>
			        	<p class="m-b-none chat" style="text-align: right" ng-if="msg.type > 1"><small class="text-muted">{{ msg.created_at | mydate: "h:mm a" }}</small></p>
			        </div>
		      	</div>

		    </div>
		    <footer class="panel-footer">
		     	<div>
			        <form class="m-b-none">
			        	<div class="input-group" >
				        	<span class="input-group-addon" ngf-select="onClickAttach($file)" ngf-max-size="10MB"								ngf-accept="'image/*,application/pdf'" ngf-pattern="'image/*,application/pdf'">
				        		<i class="fa fa-plus text-success" style="font-size:.7vw;"></i>
				        	</span>
			        		<input type="text" class="form-control" ng-model="current_session.chat" placeholder="Write a message..."
			        		ng-keyup="$event.keyCode == 13 && onSendMessage(current_session.chat)"
			        		ng-change="onChangeChat(current_session.chat)"  ng-model-options="{debounce: 500}"
			        		>
			        		<span class="input-group-btn">
			        			<button class="btn btn-default" type="button" ng-disabled="!current_session.chat" style="font-size: 12px" ng-click="onSendMessage(current_session.chat)">Send</button>
			        		</span>
			        	</div>
			        </form>
			    </div>
		    </footer>
		</div>
	</div>
</div>
