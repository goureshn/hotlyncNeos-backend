<div ng-controller="MycallFinanceMobileController">
    <style>
        .img_size {
            height: 20px;
            width: 20px;
        }

        th.active {
            font-weight: bold;
        }

        thead,
        tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
    </style>
    <script type="text/ng-template" id="returnfinanceModal.html">
    <div ng-include="'tpl/mytask/call/return_reply_finance.html'"></div>
  </script>
    <!--dialog display-->
    <div ng-if="viewcallinformation == true" style="position: absolute;
			 left: 25%; top: 5%; z-index:11;
	width: 50%; background-color: #eeeded;
	border-radius: 4px; border: 1px solid #dee5e7;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
        <div>
            <p class="pull-left" style="margin-top: 8px;margin-left: 10px;">
                <i class="glyphicon glyphicon-user"></i>&nbsp;
                <i class="fa fa-history"></i>&nbsp;Department: {{call.department}} &nbsp;&nbsp;{{call.title}}
            </p>
            <button class="btn btn-xs btn-danger pull-right" style="background:; margin-top: 4px; margin-right: 4px" data-toggle="tooltip"
                title="Close" data-placement="bottom" ng-click="closeCallInformation()">
                <i class="fa fa-times fa-fw"></i>
            </button>
        </div>

        <div class="table table-responsive">
            <table st-table="datacalllist" st-pipe="getDataCallList" style="width:100%" class="table ticket table-striped b-t b-light">
                <thead style="text-align:center;">
                    <tr class="tblhead-sm">
                        <th class="datetime text-center" style="width: 8%; white-space: nowrap">
                            <a st-sort="date" st-sort-default="reverse">&nbsp;&nbsp;Date&nbsp;</a>&nbsp;
                        </th>
                        <th class="text-center" style="width: 5%; white-space: nowrap">
                            <b>Time&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 5%">
                            <b>From #</b>
                        </th>
                        <th class="text-center" style="width: 10%; white-space: nowrap">
                            <b>Phone #&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 6%; white-space: nowrap" st-sort="duration">
                            <b>&nbsp;Duration&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 8%; white-space: nowrap">
                            <a st-sort="call_type">&nbsp;&nbsp;Call Type&nbsp;</a>&nbsp;
                        </th>
                        <th class="text-center" style="width: 6%" st-sort="charges">
                            <b>&nbsp;Cost&nbsp;</b>
                        </th>
                    </tr>
                </thead>
                <tbody fill-height additional-padding="200" style="display:block;">
                    <tr class="" ng-repeat="row in datacalllist">
                        <td class="text-center" style="width: 8%; white-space: nowrap">{{row.date}}</td>
                        <td class="text-center" style="width: 5%; white-space: nowrap">{{row.time}}</td>
                        <td class="text-center" style="width: 5%">{{row.call_from}}</td>
                        <td class="text-center" style="width: 10%; white-space: nowrap">{{row.call_to}}</td>
                        <td class="text-center" style="width: 6%; white-space: nowrap">{{getDurationInMinute(row.duration)}} </td>
                        <td class="text-center" style="width: 8%; white-space: nowrap">{{row.call_type}}</td>
                        <td style="text-align: right; padding-right: 20px; width: 6%">{{ currency }} {{row.charges | number :2}}</td>
                    </tr>
                    <tr ng-show="isCallLoading">
                        <td colspan="7" class="text-center">
                            <i class="fa fa-spin fa-refresh"></i>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr ng-show="paginationOptions.totalItems > paginationOptions.pageSize">
                        <td colspan="4" class="text-center">
                            <div st-pagination="" st-items-by-page="paginationOptions.pageSize" st-displayed-pages="7" class="no-margin"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!----- main list for finanace-------------->
    <div class="hbox">
        <div class="col b-r bg-auto" style="width: 330px">
            <div style="padding: 4px; margin-bottom: 29px" ng-show="auth_svc.isValidModule('app.callaccounting.finance_edit')">
                <button ng-if="classifystatus=='Personal'" class="btn btn-sm w-xs btn-default pull-left" ng-click="onFinanceClose('agent','')"
                    ng-disable="filter.depart_selected < 0">
                    <i class="fa fa-flag-checkered" aria-hidden="true"></i>&nbsp;Close</button>
                <button ng-if="classifystatus=='Business'" class="btn btn-sm w-xs btn-default pull-left" ng-click="onFinanceClose('charged','')"
                    ng-disable="filter.depart_selected < 0">
                    <i class="fa fa-credit-card" aria-hidden="true"></i>&nbsp;Charged</button>
            </div>
            <div class="table table-responsive">
                <table st-table="datalist" st-pipe="getDataList" class="table ticket">
                    <thead class="color-header">
                        <tr class="tblhead-sm">
                            <th style="text-align:left; width: 5%; padding-left: 3px;">
                                <input type="checkbox" ng-model="filter.depart_selected" ng-click="onChangeDepartTotalSelected()" />
                            </th>
                            <th style="width: 35%; text-align:left; padding-left: 3px;">
                                <b>Department</b>
                            </th>
                            <th style="width: 20%; text-align:center;" ng-if="classifystatus == 'Personal'" title="Number of 'Unclassified' calls by Department">
                                <b>User</b>
                            </th>
                            <th  style="width: 20%; text-align:center;" ng-if="(disable_mgr==0) && classifystatus == 'Personal'" title="Number of calls that are pending for approval">
                                <b>HOD</b>
                            </th>
                            <th  style="width: 20%; text-align:center;">
                                <b ng-if="classifystatus == 'Business'">Personal</b>
                                <b ng-if="(disable_mgr==0)&&classifystatus == 'Personal'" title="Number of calls to be closed">Fin.</b>
                            </th>
                            <th ng-if="(disable_mgr==1) && (classifystatus == 'Personal')" style="width: 20%; text-align:center;">
                                <b>For Approval</b>
                            </th>
                        </tr>
                    </thead>
                    <tbody ng-hide="isLoading" fill-height additional-padding="50" style="display:block">
                        <tr ng-repeat="row in datalist" style="cursor:pointer;{{row.cnt > 0  ? 'background-color: #dcf6f3' : ''}}">
                            <td style="text-align:center; width: 5%">
                                <input type="checkbox" ng-model="row.depart_selected" />
                            </td>
                            <td style="width: 35%; text-align:left;" ng-click="getSelectDetailCallList(row,$index)">{{row.department}}</td>
                            <td style="width: 20%; text-align:center; text-decoration: underline; color: #258" ng-if="classifystatus == 'Personal'" ng-click="getCallInformation(row,'Unclassified')">{{row.unclasscount}}</td>
                            <td style="width: 20%; text-align:center; text-decoration: underline; color: #258" ng-if="(disable_mgr==0) && classifystatus == 'Personal'" ng-click="getCallInformation(row,'Waiting For Approval')">{{row.waitingcount}}</td>
                            <td  ng-if="(disable_mgr==0) || classifystatus == 'Business' " style="width: 20%; text-align:center; padding-right: 20px; text-decoration: underline; color: #258" ng-click="getSelectDetailCallList(row,$index)">
                                <!--<span style="white-space: nowrap;">{{row.cnt > 0 ? 'Pending for Approval' : 'OK'}}</span><br/>-->
                                <!--AED {{row.cost}}-->
                                {{row.cnt}}
                            </td>
                            <td ng-if="(disable_mgr==1) && (classifystatus == 'Personal')" style="width: 20%; text-align:center; text-decoration: underline; color: #258"  ng-click="getCallInformation(row,'Waiting For Approval')">{{row.waitingcount}}</td>
                        </tr>
                    </tbody>
                    <tbody ng-show="isLoading">
                        <tr>
                            <td colspan="3" class="text-center">
                                <i class="fa fa-spin fa-refresh"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col">
            <div style="padding: 4px; margin-bottom: 29px" ng-show="auth_svc.isValidModule('app.callaccounting.finance_edit')">
                <a type="button" ng-if="classifystatus=='Business'" class="btn btn-sm w-xs btn-default pull-left" ng-click="getClassifystatus()"
                    title="Show Business Calls">
                    <i class="fa fa-black-tie" aria-hidden="true"></i>&nbsp;Business</a>

                <a type="button" ng-if="classifystatus=='Personal'" class="btn btn-sm w-xs btn-default pull-right" ng-click="onFinanceClose('agent','')">
                    <i class="fa fa-flag-checkered" aria-hidden="true"></i>&nbsp;Close</span>
                </a>

                <a type="button" ng-if="classifystatus=='Personal'" class="btn btn-sm w-xs btn-default pull-left" ng-click="getClassifystatus()"
                    title="Show Personal Calls">
                    <i class="icon-user"></i>&nbsp;Personal</a>

                <a type="button" ng-if="classifystatus=='Business'" class="btn btn-sm w-xs btn-default pull-right" ng-click="onFinanceClose('charged','')">
                    <i class="fa fa-credit-card" aria-hidden="true"></i>&nbsp;Charged</a>
            </div>
            <div class="table table-responsive" fill-height additional-padding="40">
                <table st-table="detaillist" st-pipe="getDetailCallList" style="width: 100%" class="table ticket table-striped b-light">
                    <thead class="tblhead-sm">
                        <tr style="text-align:middle;">
                            <th style="text-align:center; width: 5%">
                                <input type="checkbox" ng-model="filter.total_selected" ng-click="onChangeTotalSelected()">
                            </th>
                            <th style="text-align:center;">
                                <b>Date</b>
                            </th>
                            <th style="text-align:center;">
                                <b>From #</b>
                            </th>
                            <th style="text-align:center; white-space: nowrap;">
                                <b>Phone #</b>
                            </th>
                            <th style="text-align:center; white-space: nowrap">
                                <b>Call Type</b>
                            </th>
                            <th style="text-align:center;">
                                <b>Cost</b>
                            </th>
                            <th style="text-align:center; min-width:300px">
                                <b>Reason</b>
                            </th>
                            <th style="text-align:center;">
                                <b>Status</b>
                            </th>
                            <th style="text-align:center;">Action
                                <!--<b ng-hide="selected_count > 1">Action</b>
                            <select style="color:#212121" class='input-sm' ng-model="filter.approval_temp" ng-change="onChangeTotalApproval()" ng-show="selected_count >= 2"
                                    ng-options="type for type in approve_types">
                            </select>-->
                            </th>
                        </tr>
                        <tr>
                        </tr>
                    </thead>
                    <tbody ng-hide="isChildLoading" ng-repeat="row in detaillist">
                        <tr>
                            <td style="text-align:center; width:5%">
                                <input type="checkbox" ng-model="row.selected" ng-click="onChangeSelected()">
                            </td>
                            <td colspan="8" style="white-space: nowrap" valign="middle">
                                {{row.wholename}}&nbsp;&nbsp;
                                <span ng-class="row.downimage" style="cursor: pointer;" ng-click="onClickRow(row, $index)"></span>
                            </td>
                        </tr>
                        <tr ng-if="row.collapse" ng-repeat="row1 in row.inform">
                            <td class="text-center" style="width:5%">
                                <input type="checkbox" ng-model="row1.selected">
                            </td>
                            <td class="text-center" style="white-space: nowrap" valign="middle">{{row1.date}}</td>
                            <td class="text-center">{{row1.call_from}}</td>
                            <td class="text-center">{{row1.call_to}}</td>
                            <td class="text-center">{{row1.call_type}}</td>
                            <td style="text-align: right; padding-right: 20px">AED {{row1.charges | number :2}}</td>
                            <td style="min-width:300px">{{row1.comment}}</td>
                            <td class="text-center" style="white-space: nowrap">{{row1.approval}}</td>
                            <!--<td calss='text-center'style="white-space: nowrap" ng-if="row1.approval == 'Approved'">-->
                            <td class="text-center" style="white-space: nowrap">
                                <i class="fa fa-thumbs-up" aria-hidden="true" style="font-size: 20px; color: #84b262" ng-if="classifystatus=='Personal'"
                                    style="cursor:pointer" ng-click="onFinanceClose('child',row1)" title="Closed"></i>&nbsp;&nbsp;
                                <i class="fa fa-thumbs-down" aria-hidden="true" style="font-size: 20px" ng-if="classifystatus=='Business'" style="cursor:pointer"
                                    ng-click="onFinanceClose('charged',row1)" title="Charged"></i>&nbsp;&nbsp;
                                <!--<i class="fa fa-mail-reply" aria-hidden="true" style="font-size: 20px; color: #f6846a" ng-if="classifystatus=='Business'"-->
                                <!--style="cursor:pointer" ng-click="onFinanceClose('child_return')" title="Returned"></i>-->
                                <i class="fa fa-mail-reply" aria-hidden="true" style="font-size: 20px; color: #f6846a" ng-if="classifystatus=='Personal'"
                                    style="cursor:pointer" ng-click="onFinanceReturn(row1,'child_return')" title="Returned"></i>
                                <i class="fa fa-mail-reply" aria-hidden="true" style="font-size: 20px; color: #f6846a" ng-if="classifystatus=='Business'"
                                    style="cursor:pointer" ng-click="onFinanceReturn(row1,'child_return_unclassified')" title="Returned"></i>
                            </td>
                            <!--
              <td  style="text-align:center;">
                <select class='input-sm' ng-model="row.approval_temp" ng-change="onChangeApproval(row)" ng-disabled="selected_count > 1"
                  ng-options="type for type in approve_types">
                </select>
              </td>
              -->
                        </tr>
                    </tbody>

                    <tbody ng-show="isChildLoading">
                        <tr>
                            <td colspan="10" class="text-center">
                                <i class="fa fa-spin fa-refresh"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>