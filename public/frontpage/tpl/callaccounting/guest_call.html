<div ng-controller="GuestCallController">
  <script type="text/ng-template" id="guestrateTemplate.html">
    <div class="form-group">
      <p>Carrier Rate: {{row.carrier_rate}}/min</p>
      <p>Hotel charge Rate: {{getRoundValue(row.carrier_rate * row.hotel_rate / 100)}}/min</p>
      <p>Tax Rate: {{getRoundValue(row.carrier_rate * row.tax_rate / 100)}}/min</p>
      <p>Total Rate: {{getRoundValue(row.carrier_rate + row.carrier_rate * row.hotel_rate / 100 + row.carrier_rate * row.tax_rate / 100)}}/min</p>
    </div>
  </script>
	
	<script type="text/ng-template" id="CallTypeGuestCall.html">
		<label style="color:#000000">Call Type : </label>
      <select class='input-sm' ng-model="filters.call_type" ng-change="onChangeCallType()" ng-options="type for type in calltypes" style="color:#000000">
      </select>
  </script>
<!--
  <script type="text/ng-template" id="BuildingGuestCall.html">
    <label style="color:#000000">Building : </label>
  <select class='input-sm' ng-model="filters.building_id" ng-change="onChangeBuilding()" ng-options="value.id as value.name for (key, value) in buildings" style="color:#000000">
  </select>
</script>
-->
<script type="text/ng-template" id="BuildingGuestCall.html">
    <div class="btn-group" uib-dropdown is-open="status.isopen" auto-close="disabled" >
        <ul class="headfilter" role="menu" style="list-style: none; margin-left:-50px;">
            <li class="line-sm" ng-repeat="building in filter.buildings">
                <label class="md-check" style="margin-left: 20px;">
                    <input type="checkbox" ng-model="building.selected"  ng-click="onChangeBuilding(building)"  />
                    <i class="green"></i>
                    {{building.name}}
                </label>
            </li>
        </ul>
    </div>
</script>
	
	<script type="text/ng-template" id="DateGuestCall.html">
        <style>
            .popover {
                max-width: 300px;
            }
        </style>

        <div uib-datepicker ng-model="filters.call_date" datepicker-options="dateOptions" date-disabled="  disabled(date, mode)" ng-change="select()">                
        </div>            
    </script>
    <div style="padding: 3px">
		<div class="pull-left">
			<label style="margin-left: 18px; margin-top: 5px">
				<i class="fa fa-money" aria-hidden="true"></i>&nbsp;<b>Charged Calls</b>
			</label>
		</div>
	    <div class="pull-left" style="margin-left: 20px">
	        <label class="i-switch m-t-xs m-r"  >
	          <input type="checkbox" ng-model="totalcharge" ng-click="onTotalCharge()" >
	            <i></i>
	        </label>
	    </div>
	    <div class="input-group col-sm-2 pull-left">
            <input type="text" ng-model="searchtext" ng-keyup="onSearch()"  class="form-control input-sm bg-light no-border rounded padder" placeholder="Search">
            <span class="input-group-btn">
                <button type="submit" class="btn btn-sm bg-light rounded" ng-key=""><i class="fa fa-search"></i></button>
            </span>
	    </div>
        <div class="col-sm-2">
            <button type="button" class="btn btn-sm btn-bg btn-default" ng-click="onShowCallRateDlg()">
                <i class="fa fa-calculator"></i>&nbsp;Calc Call Rate
            </button>                               
        </div>
        <div class="pull-right">
	        <label style="margin-right: 20px; margin-top: 5px; margin-bottom: 0px">
		        <i class="fa fa-phone" aria-hidden="true"></i>&nbsp;<b>Total Calls</b> : <label style="color: #FF5722"> {{total_count}}&nbsp; &nbsp;</label>|&nbsp; &nbsp;
                <i class="fa fa-usd" aria-hidden="true"></i>&nbsp;<b>Total</b> : <label style="color: #FF5722"> {{ currency }} {{total_cost | number :2}} &nbsp; &nbsp; </label>|&nbsp; &nbsp;
		        <i class="fa fa-line-chart" aria-hidden="true"></i>&nbsp;&nbsp;<b>Total Profit</b> : <label style="color: #FF5722"> {{ currency }} {{total_profit | number :2}} </label>
		    </label>
	    </div>
    </div>
    <div>
        <div class="table table-responsive" style="{{full_height}}">
            <table  st-table="guestlist" st-template='<a ng-click="selectPage(1)">got to first</a> <a ng-click="selectPage(numPages)">go to last</a>'  st-pipe="getDataList" class="table ticket table-striped b-t b-light " >
                <thead class="tblhead-sm">
					<tr >
						<th class="text-center" style="width: 45px; white-space: nowrap">
                            <a st-sort="id" st-sort-default="reverse">&nbsp;Time</a>&nbsp;
                            <b class="fa fa-fw fa-filter" uib-popover-template="'DateGuestCall.html'" popover-is-open="date_selector_is_open" popover-placement="bottom-left"></b>
                        </th>
                        
                        <th class="text-center" style="width: 90px"> <a st-sort="building">Building&nbsp;</a>
                            <b ng-show="filter.buildings.length > 1" class="fa fa-fw fa-filter" uib-popover-template="'BuildingGuestCall.html'" popover-trigger="outsideClick" popover-placement="bottom" ng-style="{'color' : buildingcolor}"></b>
                        </th>
                        <th class="text-center" st-sort="room" style="width: 90px; white-space: nowrap"><b>Room #</b></th>
                        <th class="text-center" style="width: 250px"><b>Guest</b></th>
                        <th class="text-center" style="width: 90px"><b>Extension</b></th>                        
                        <th class="text-center" style="width: 100px; white-space: nowrap"><b>Called No.</b></th>
                        <th class="text-center" style="width: 90px"> <a st-sort="call_type">Type&nbsp;</a>
                            <b class="fa fa-fw fa-filter" uib-popover-template="'CallTypeGuestCall.html'" popover-trigger="outsideClick" popover-placement="right"></b>
                        </th>
                        <th class="text-center" style="width: 90px"><b>Room Type</b></th>
                        <th class="text-center" style="width: 90px"><b>VIP</b></th>
                        <th class="text-center" style="width: 90px"><b>Trunk</b></th>
                        
                        <th class="text-center" style="width: 90px" st-sort="duration"><b>Duration</b></th>
                        <th class="text-center" style="width: 90px;"><b>Pulse</b></th>
                        <th class="text-center" style="width: 100px;" st-sort="country"><b>Destination</b></th>
                        <th class="text-center" style="width: 90px"><b>Carrier</b></th>
                        <th class="text-center" style="width: 90px"><b>Tax</b></th>
                        <th class="text-center" style="width: 90px"><b>Charges</b></th>
                        <th class="text-center" style="width: 90px"><b>Total</b></th>
                    </tr>
                    <tr>
                    </tr>
				</thead>
                <tbody ng-hide="isLoading">
					<tr ng-repeat="row in datalist">
                        <td class="text-center">{{row.start_time}}</td>
                        <td class="text-center">{{row.building}}</td>
                        <td class="text-center">{{row.room}}</td>
                        <td class="text-center">{{row.guest_name}}</td>
                        <td class="text-center">{{row.extension}}</td>
                        <td class="text-center">{{row.called_no}}</td>
                        <td class="text-center">{{row.call_type}}</td>
                        <td class="text-center">{{row.roomtype}}</td>
                        <td class="text-center">{{row.vip_name}}</td>
                        <td class="text-center">{{row.trunk}}</td>
                        
                        <td class="text-center">{{getDuration(row)}}</td>
                        <td class="text-center">{{row.pulse}}</td>
                        <td class="text-center">
                          <a  style="color:#5499C7;" uib-popover-template="'guestrateTemplate.html'" popover-trigger="mouseenter"
	                          popover-placement="right" popover-title="{{row.country}}">{{row.country}}
		                      </a>
                        </td>
                        <td class="text-center">{{row.carrier_charges | number :2}}</td>
                        <td class="text-center">{{row.tax | number :2}}</td>
                        <td class="text-center">{{row.hotel_charges | number :2}}</td>
                        <td class="text-center"><b>{{row.total_charges | number :2}}</b></td>
                    </tr>
                </tbody>
                <tbody ng-show="isLoading">
                    <tr>
                        <td colspan="17" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                    </tr>
                </tbody>
				<tfoot ng-hide="isLoading" style="padding:0px;">
                    <tr ng-show="paginationOptions.totalItems > paginationOptions.pageSize">
                        <td colspan="17" class="text-center">
                            <div id="pagerId" st-pagination="" st-items-by-page="paginationOptions.pageSize" st-displayed-pages="7" class="no-margin">
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        
		</div>  
    </div>      
</div>
