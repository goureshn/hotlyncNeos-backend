<div ng-controller="MycallMobileClassificationController as vm" class="" style="overflow-x: hidden">
    <style>
        .datetime .popover {
            max-width: 687px;
        }
        .rg-range-picker {
            max-width: 650px;
        }
        .total_count {
             background-color: #2c3e50;
             margin-bottom: 0px;
             border-radius: 6px;
        }
        thead, tbody tr {
					display:table;
					width:100%;
					table-layout:fixed;
				}
    </style>
    
    <style>
        .headfilterlist {
        font-family: "Titillium Web";
        font-size: 12px;
        -webkit-font-smoothing: antialiased;
        line-height: 1.42857143;
        color: #212121;
        }
        .btnfilter {
            height:30px;
        }
    </style>

    <script type="text/ng-template" id="datetime_ranger.html">
        <div style="width: 650px">
            <div rg-range-picker="myDatetimeRange" labels="myDatetimeLabels"></div>
        </div>
    </script>
    <script type="text/ng-template" id="MoreInfoModal.html">
        <div ng-include="'tpl/mytask/call/call_mobile_inform.html'"></div>
    </script>

    <!-- CALL TYPE -->

    <script type="text/ng-template" id="call_type.html">
        <div class="btn-group" uib-dropdown is-open="status.isopen" auto-close="disabled" ng-controller="CallTypeController">
            <ul class="headfilter" role="menu" style="list-style: none; margin-left:-50px;">
                <li class="line-sm" ng-repeat="type in calltypes">
                    <label class="md-check" style="margin-left: 20px">
                    <input type="checkbox" ng-model="call_filter[type]" ng-click="onChangeCallType(type)">
                    <i class="green"></i>
                    {{type}}
                    </label>
                </li>
            </ul>
        </div>
    </script>

    <!-- CALL CLASSIFICATION -->
    <script type="text/ng-template" id="call_classify.html">
        <div class="btn-group" uib-dropdown is-open="status.isopen" auto-close="disabled" ng-controller="ClassifyController">
            <ul class="headfilter" role="menu" style="list-style: none; margin-left:-50px;">
                <li class="line-sm" ng-repeat="type in classify_filter_types">
                    <label class="md-check" style="margin-left: 20px">
                    <input type="checkbox" ng-model="classify_filter[type]" ng-click="onChangeClassify(type)">
                    <i class="green"></i>
                    {{type}}
                    </label>
                </li>
            </ul>
        </div>
    </script>

    <!-- CALL STATUS -->
    <script type="text/ng-template" id="call_status.html">
        <div class="btn-group" uib-dropdown is-open="status.isopen" auto-close="disabled" ng-controller="ApprovalController">
            <ul class="headfilter" role="menu" style="list-style: none; margin-left:-50px;">
                <li class="line-sm" ng-repeat="state in approve_states">
                    <label class="md-check" style="margin-left: 20px;">
                        <input type="checkbox" ng-model="approve_filter[state]" ng-click="onChangeApproval(state)">
                        <i class="green"></i>
                        {{state}}
                    </label>
                </li>
            </ul>
        </div>
    </script>

    <!-- CALL extension -->
    <script type="text/ng-template" id="call_extension.html">
        <div class="btn-group" uib-dropdown is-open="status.isopen" auto-close="disabled" >
            <ul class="headfilter" role="menu" style="list-style: none; margin-left:-50px;overflow-y: auto;height: 200px;">
                <li class="line-sm" ng-repeat="extn in filter.extensions">
                    <label class="md-check" style="margin-left: 20px;">
                        <input type="checkbox" ng-model="extn.selected"  ng-click="onChangeExtension(extn)"  />
                        <i class="green"></i>
                        {{extn.extension}}
                    </label>
                </li>
            </ul>
        </div>
    </script>

    <script type="text/ng-template" id="classifyReasonModal.html">
        <div ng-include="'tpl/mytask/call/classify_reason.html'"></div>
    </script>
    <script type="text/ng-template" id="classifyPersonalModal.html">
            <div ng-include="'tpl/mytask/call/classify_personal_reason.html'"></div>
        </script>
    <script type="text/ng-template" id="returnReplyModal.html">
        <div ng-include="'tpl/mytask/call/return_reply.html'"></div>
    </script>

    <div>
        <div>
            <div class="row" style="padding: 4px 4px 0px 0px" uib-dropdown>
                <div class="btn-toolbar" style="float:left;padding-left: 20px;">
                    <div class="btn-group">
                        <button class="btn btn-sm btn-icon btn-default" data-toggle="tooltip" title="Filter" data-placement="bottom" data-ng-click="openFilterPanel('left',
                        true)">
                            <i class="fa fa-filter"></i>
                        </button>
                    </div>
                    <!-- <div class="btn-group">
                        <button id="dateranger" class="btn btn-sm btn-icon btn-default" data-toggle="tooltip" title="Filter" data-placement="bottom"
                                data-title="Refresh" ui-jq="daterangepicker" ui-options="dateRangeOption" class="form-control pull-right input-sm">
                            <i class="fa fa-calendar"></i>
                        </button>
                    </div> -->
                    <div class="btn-group">
                        <button class="btn btn-sm btn-icon btn-default" data-toggle="tooltip" title="Refresh"
                        data-placement="bottom" ng-click="refreshTickets()">
                          <i class="fa fa-refresh"></i>
                        </button>
                    </div>
                    <!--
                    <div class="btn-group">
                    	<button class="btn btn-sm btnfilter  bg-wakeup-pending" data-toggle="tooltip" title="Personal" data-placement="bottom" ng-click="onFilterShort('Personal')"> 
                        <i class=""></i><label><b>P</b></label>
	                    </button>
                    </div>
                    <div class="btn-group">
                    	<button class="btn btn-sm btnfilter bg-wakeup-success" data-toggle="tooltip" title="Approved" data-placement="bottom" ng-click="onFilterShort('Approved')"> 
                        <i class=""></i><label><b>A</b></label>
											</button>
                    </div>
                    <div class="btn-group">
                    	<button class="btn btn-sm btnfilter bg-danger" data-toggle="tooltip" title="Waiting For Approval" data-placement="bottom" ng-click="onFilterShort('Waiting For Approval')"> 
                        <i class=""></i><label><b>W</b></label>
                      </button>
                    </div>
                    <div class="btn-group">
                    	<button class="btn btn-sm btnfilter bg-success" data-toggle="tooltip" title="Closed" data-placement="bottom" ng-click="onFilterShort('Closed')">
                        <i class=""></i><label><b>C</b></label>
                      </button>
                    </div>
                    <div class="btn-group">
                      <button class="btn btn-sm btnfilter bg-all" data-toggle="tooltip" title="Show All" data-placement="bottom" ng-click="onFilterShort('Total')">
                        <i class=""></i><label><b>ALL</b></label>
                      </button>
                    </div>-->
                </div>
                
                <div class=" btn-group pull-right col-sm-1" data-toggle="tooltip" data-placement="bottom">
                    <button class="btn btn-sm btn-primary pull-right" ng-click="phonebook(row)">
                        <i class="fa fa-address-book" style="margin: auto"></i>
                    </button>
                  
                </div>
                
                <div class=" btn-group pull-right" data-toggle="tooltip" data-placement="bottom">
                    <button ng-disabled="(selected_count<=0 && selected_sub.length<=0)"ng-model="select_all" class="btn btn-sm m-b-xs w-sm btn-success text-success font-bold ng-pristine ng-untouched ng-valid ng-binding ng-not-empty"
                        ng-click="onChangeClassifyMultiple('Personal')">
                        Personal
                    </button>
                    <button ng-disabled="(selected_count<=0 && selected_sub.length<=0) " ng-model="select_all" class="btn btn-sm m-b-xs w-sm btn-info text-success font-bold ng-pristine ng-untouched ng-valid ng-binding ng-not-empty"
                        ng-click="onChangeClassifyMultiple('Business')">
                        Business
                    </button>
                </div>
                <div class="col-sm-2 btn-group pull-right" data-toggle="tooltip" data-placement="bottom">
                    <button ng-model="select_all" class="btn btn-sm m-b-xs w-sm pull-right font-bold ng-pristine ng-untouched ng-valid ng-binding ng-not-empty"
                        ng-click="checkGroupBy()">
                        {{groupby_num_text}}
                    </button>
                </div>
                <div class="input-group col-sm-2 " style="padding-left: 20px;">
                      <input type="text" ng-model="searchtext" ng-keyup="onSearch()" class="form-control input-sm bg-light no-border padder" placeholder="Search">
                      <span class="input-group-btn">
                        <button type="submit" class="btn btn-sm bg-light"><i class="fa fa-search"></i></button>
                      </span>
                </div>
                <!--<button type="button" class="btn pull-right " style="background-color: #FF9800; color: #fff;" ng-click="sendApproval()">-->
                	<!--Classify-->
                <!--</button>-->
            </div>
        </div>
        <div class="table table-responsive" fill-height additional-padding="120">
            <!-- - - - - - - UNGROUPED CALLS - - - - - - -->
            <table  ng-if="(groupby_num_flag==0)" st-table="datalist" st-pipe="getDataList" style="width:100%" class="table ticket table-striped b-t b-light">
                <thead style="text-align:center;">
                    <tr class="tblhead-sm">
                        <th class="text-center" style="width: 2%; white-space: nowrap"><input type="checkbox" ng-model="filter.total_selected" ng-click="onChangeTotalSelected()"></th>
                        <th class="datetime text-center" style="width: 10%; white-space: nowrap">
                            <a st-sort="date" st-sort-default="reverse" >&nbsp;&nbsp;Date&nbsp;</a>&nbsp;
                        </th>
                        <th class="text-center" style="width: 10%; white-space: nowrap"><b>Time&nbsp;</b></th>
                        <th class="text-center" style="width: 10%">
                            <a st-sort="date">&nbsp;&nbsp;From</a>&nbsp;
                        </th>
                        <th class="text-center" style="width: 10%; white-space: nowrap"><b>Phone #&nbsp;</b></th>
                        <th class="text-center" style="width: 8%; white-space: nowrap" st-sort="duration">
	                        <b>&nbsp;Duration&nbsp;</b>
	                      </th>
                        <th class="text-center" style="width: 10%; white-space: nowrap">
                            <b>&nbsp;Call Type&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 10%" st-sort="carrier_charges"><b>&nbsp;Cost&nbsp;</b></th>
                        <th class="text-center" style="white-space: nowrap; width: 10%">
                            <b>&nbsp;Classification&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 10%">
                        <b>&nbsp;Status&nbsp;</b>
                        </th>
                        
                       
                        <th class="text-center" style="width: 10%"><b>Action</b></th>
                    </tr>
                    <tr>                        
                    </tr>
                </thead>
                <tbody ng-show="!isLoading"  style="display:block;">
                    <tr class="" ng-repeat="row in datalist">
                        <td align="right" style="width: 2%; white-space: nowrap"><input align="right" type="checkbox"  ng-model="row.selected" ng-click="onChangeSelected()"></td>
                        <td class="text-center" style="width: 10%; white-space: nowrap">{{row.date}}</td>
                        <td class="text-center" style="width: 10%; white-space: nowrap">{{row.time}}</td>
                        <td class="text-center" style="width: 10%">{{row.call_from}}</td>
                        <td  ng-show="row.phonebk_flag==0" class="text-center" style="width: 10%; white-space: nowrap">{{row.call_to}}</td>
                        <td ng-show="row.phonebk_flag==1" class="text-center" style="color: #15008b; width: 10%; white-space: nowrap">{{row.contact_name}}</td>
                        <td class="text-center" style="width: 8%; white-space: nowrap">{{getDurationInMinute(row.duration)}}</td>
                        <td class="text-center" style="width: 10%; white-space: nowrap">{{row.call_type}}</td>
                        <td style="text-align: right; padding-right: 20px; width: 10%">{{ currency }} {{row.charges | number :2}}</td>
                        <td ng-show="row.classify != 'Unclassified' && row.classifyhide == true "
        	                ng-click="!row.approval_temp != 'Unclassified' || onChangeClassifyView(row)"
        	                class="text-center" style="white-space: nowrap; width: 10%">
                            {{row.classify}}
                        </td>
                        <td style="width: 10%" class="text-center" ng-show="row.classify != 'Unclassified' && row.classifyhide == false ">
                            <select class="input-sm text-center" ng-model="row.classify_temp"
    	                        ng-change="onChangeClassify(row)" ng-options="type for type in classify_types">
                            </select>
                        </td>
                        <td style="width: 10%" class="text-center" ng-show="row.classify == 'Unclassified' && row.classifyhide == false ">
                            <select style="text-align: center" class="input-sm" ng-model="row.classify_temp"
    	                        ng-change="onChangeClassify(row)"
                              ng-options="type for type in classify_types">
                            </select>
                        </td>
                        <td style="width: 10%" class="text-center" ng-click="onClickApproval(row)">{{row.approval}}</td>
                       
                  
                        <td class="text-center" style="width: 10%">
                            <i class="fa fa-mail-reply" aria-hidden="true" style="font-size: 20px; cursor: pointer; color: #f6846a"
                               ng-if="row.approval_temp == 'Returned'" ng-click="onClickApproval(row)" title="Returned">&nbsp;</i>
                            <i class="fa fa-info-circle text-warning" aria-hidden="true" style="font-size: 20px; cursor: pointer"
                               ng-if="row.approval_temp != 'Returned'" ng-click="onMoreInfo(row)" title="More Info"></i>
                        </td>
                    </tr>
                    <tr ng-show="isLoading">
                        <td colspan="10" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                    </tr>
                </tbody>
            </table>
            <!-- - - - - - - /UNGROUPED CALLS - - - - - - -->

            <!-- - - - - - - GROUPED CALLS - - - - - - -->
            <table st-table="datalist" ng-if="(groupby_num_flag==1)" st-pipe="getDataList" style="width:100%" class="table ticket table-striped b-t b-light">
                <thead style="text-align:center;">
                    <tr class="tblhead-sm">
                        <th class="text-center" style="width: 2%; white-space: nowrap">
                            <!-- <input type="checkbox" ng-model="filter.total_selected" ng-click="onChangeTotalSelected()"> -->
                        </th>
                        <th class="text-center" style="width: 4%; white-space: nowrap">
                            <!-- <input type="checkbox" ng-model="filter.total_selected" ng-click="onChangeTotalSelected()"> -->
                        </th>
                        <th class="text-center" style="width: 24%; white-space: nowrap">
                            <b>Called Number #&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 23%; white-space: nowrap" st-sort="cnt">
                            <b>&nbsp;Number of Calls&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 24%; white-space: nowrap" st-sort="total_time">
                            <b>&nbsp;Total Duration&nbsp;</b>
                        </th>
                        <th class="text-center" style="width: 23%" st-sort="carrier_charges">
                            <b>&nbsp;Total Cost&nbsp;</b>
                        </th>
                    </tr>
                </thead>
                <tbody ng-show="!isLoading"   style="display:block;">
                    <tr class="" ng-repeat="row in datalist">
                        <td colspan="7">
                            <table style="width: 100%">
                                <tr >
                                    <td class="text-center" style="width: 2%">
                                        <input type="checkbox" ng-model="row.selected" ng-click="onChangeSelected(row,$index)">
                                    </td>
                                    <td class="text-center" style="width: 4%" ng-click="getViewDetail(row,$index)">
                                        <i ng-show="!row.collapse" class="fa fa-chevron-down"> </i>
                                         <i ng-show="row.collapse" class="fa fa-chevron-up"> </i>
                                    </td>
                                    <td ng-show="row.phonebk_flag==0" class="text-center" style="width: 24%">{{row.call_to}}</td>
                                    <td ng-show="row.phonebk_flag==1" class="text-center" style="color: #15008b; width: 24%; white-space: nowrap">{{row.contact_name}}</td>
                                    <td class="text-center" style="width: 23%">{{row.cnt}}</td>
                                    <td class="text-center" style="width: 24%">{{row.total_time}}</td>
                                    <td class="text-center" style="width: 23%">{{currency}} {{row.totalcharge | number :2}}</td>
                                    
                                </tr>
                            </table>
                            <table ng-show="row.view && row.collapse" style="width:80%" align="center" class="table table-striped ticket">
                                <tr>
                                    <td>
                                        <div style="background: #ececec;padding-top: 20px; padding-bottom: 20px;">
                                            <div style="background:#e0dede">
                                                <label class="text-center" style="width: 6%">
                                                   
                                                </label>
                                                <label class="text-center" style="width: 12%">
                                                    <b>&nbsp;Date</b>
                                                </label>
                                                <label class="text-center" style="width: 12%">
                                                    <b>Time</b>
                                                </label>
                                                <label class="text-center" style="width: 10%">
                                                    <b>Duration</b>
                                                </label>
                                                <label class="text-center" style="width: 12%">
                                                    <b>Call Type</b>
                                                </label>
                                                <label class="text-center" style="width: 12%">
                                                    <b>Cost</b>
                                                </label>
                                                <label class="text-center" style="width: 12%">
                                                    <b>Classification</b>
                                                </label>
                                                <label class="text-center" style="width: 17%">
                                                    <b>Status</b>
                                                </label>
                                               
                                            </div>
                                            <div style="border: solid 1px; border-color: #d6d8d8" ng-repeat="row1 in row.details">
                                                <input type="checkbox" class="text-center" style="width: 6%" ng-model="row1.selected" ng-click="onChangeSelectedSingle(row1,$index,row)">
                                                <label class="text-center" style="width: 12%">{{row1.date}}</label>
                                                <label class="text-center" style="width: 12%">{{row1.time}}</label>
                                                <label class="text-center" style="width: 10%">{{getDurationInMinute(row1.duration)}}</label>
                                                <label class="text-center" style="width: 12%">{{row1.call_type}}</label>
                                                <label class="text-center" style="width: 12%">{{ currency }} {{row1.charges | number :2}}</label>
                                                <label class="text-center" style="width: 12%">{{row1.classify}}</label>
                                                <label class="text-center" style="width: 17%">{{row1.approval}}</label>
                                               
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr ng-show="isLoading">
                        <td colspan="10" class="text-center">
                            <i class="fa fa-spin fa-refresh"></i>
                        </td>
                    </tr>
                    
                </tbody>
            </table>
            <!-- - - - - - - /GROUPED CALLS - - - - - - -->
        </div>
        <table ng-hide="isLoading">
            <thead class="tblhead-sm" style="font-size: .7vw">
                <tr ng-show="paginationOptions.totalItems > paginationOptions.pageSize">
                    <td colspan="17" class="text-center">
                        <button type="button" class="btn btn-sm btn-bg btn-default">
                            {{paginationOptions.numberOfPages}}/{{paginationOptions.countOfPages}} - {{paginationOptions.totalItems}} Items
                        </button>
                        <button type="button" class="btn btn-sm btn-bg btn-default" ng-click="onPrevPage()" ng-disabled="paginationOptions.numberOfPages <= 1">
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-bg btn-default" ng-click="onNextPage()" ng-disabled="paginationOptions.numberOfPages >= paginationOptions.countOfPages">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                    </td>
                </tr>
            </thead>
        </table>
        <hr style="margin-top: 2px;">
    </div>
</div>