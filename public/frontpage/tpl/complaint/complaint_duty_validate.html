<style>
	p::first-letter {
		text-transform: capitalize;
	}
	.text-xs {
	  margin-bottom: 0px;
	  margin-top: 0px;
	}
	tags-input .tags {
		font-size: 12px;
	}

	.my-control-label {
		text-align: right;
	}

	.tab-bar {
		margin-top: 20px;		
		margin-bottom: 20px;		
	}

	.tab-bar button {		
		width: 120px;
	}

	.sub-label {
		text-align: left;
		margin-top: 8px
	}

</style>

<script type="text/ng-template" id="subcomplaint_dialog.html">
    <div ng-include="'tpl/complaint/subcomplaint_dialog.html'"></div>
</script>

<script type="text/ng-template" id="complaint_detail.html">
  	<div ng-include="'tpl/complaint/complaint_detail.html'"></div>
</script>

<script type="text/ng-template" id="compensation_detail.html">
  	<div ng-include="'tpl/complaint/compensation_detail.html'"></div>
</script>

<script type="text/ng-template" id="modal_input.html">
  	<div ng-include="'tpl/modal/modal_input.html'"></div>
</script>

<script type="text/ng-template" id="locationTypeahead.html">
	<a>
		 <span ng-bind="match.model.name"></span><br>
		 <span style="font-size: 10px" ng-bind="match.model.type"></span> - <span style="font-size: 10px" ng-bind="match.model.property"></span><br>
	</a>
 </script>

<script type="text/ng-template" id="guestTypeahead.html">
   <a>
        <span>{{match.model.guest_name}}</span><br>  
        <span style="font-size: 10px" ng-show="match.model.arrival && match.model.departure">{{match.model.arrival}} ~ {{match.model.departure}}</span><br ng-show="match.model.arrival && match.model.departure">
        <span style="font-size: 10px" ng-hide="match.model.arrival && match.model.departure">Email: {{match.model.email}}</span><br ng-hide="match.model.arrival && match.model.departure">
        <span style="font-size: 10px" ng-hide="match.model.arrival && match.model.departure">Mobile: {{match.model.mobile}}</span><br ng-hide="match.model.arrival && match.model.departure">
   </a>
</script>

<div ng-show="complaint.history_view" 
	style="position: absolute;
	right:150px; top: 135px; z-index:11;
	width:600px; background-color: #eeeded;
	border-radius: 4px; border: 1px solid #dee5e7;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
	<div>
	  <p class="pull-left" style="margin-top: 8px;margin-left: 10px;">
		  <i class="glyphicon glyphicon-user"></i>&nbsp;<i class="fa fa-history"></i>&nbsp;Guest History
		</p>
	  <button class="btn btn-xs btn-icon bg-danger  pull-right" style="margin-top: 4px; margin-right: 4px"
	    data-toggle="tooltip" title="Close" data-placement="bottom" ng-click="hideGuestHistory()">
			<i class="fa fa-times fa-fw"></i>
		</button>
  </div>
  
  <div class="table table-responsive" style="overflow-y: scroll;height:800px;">
  	<table class="table table-sm">
  		<thead>
			  <tr class="tblhead-sm">
			    <th class="text-center">Date</th>
			    <th class="text-center">Ticket#</th>
			    <th class="text-center">Service Recovery</th>
			    <th class="text-center">Status</th>
			  </tr>
  		</thead>
  		<tbody>
	    	<tr class="text-xs" ng-repeat="row in guest_history" >
	    		<td class="text-center" style="padding: 8px">{{::row.created_at_time}}</td>
	    		<td class="text-center" style="padding: 8px"><u style="cursor: pointer" ng-click="showComplaint(row)">{{::row.ticket_no}}</u></td>
	    		<td class="text-center" style="padding: 8px">{{::row.compensation_total}}</td>
	    		<td class="text-center" style="padding: 8px">
				    <span ng-class="{'label' : true, 'm-l-sm': true,
							'bg-wakeup-pending': row.status == 'Pending',
							'bg-wakeup-waiting': row.status == 'Acknowledge',
							'bg-wakeup-success': row.status == 'Resolved',
							'bg-wakeup-canceled': row.status == 'Rejected',
							'bg-wakeup-in-progress': row.status == 'Forwarded',	
							'bg-complaint-ack': row.status == 'Unresolved',
							}">{{::row.status}}
						</span>
	    		</td>
	    	</tr>
  		</tbody>
  	</table>
  </div>
</div>

<div ng-if="history_view" style="position: absolute;
	right:220px; top: 135px; z-index:11;
	width:400px; background-color: #eeeded;
	border-radius: 4px; border: 1px solid #dee5e7;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
	<div>
		<p class="pull-left" style="margin-top: 8px;margin-left: 10px;">
			<i class="glyphicon glyphicon-user"></i>&nbsp;
			<i class="fa fa-history"></i>&nbsp;Service Request History
		</p>
		<button class="btn btn-sm btn-icon bg-danger  pull-right" style="margin-top: 4px; margin-right: 4px" data-toggle="tooltip"
		 title="Close" data-placement="bottom" ng-click="hideGSHistory()">
			<i class="fa fa-times fa-fw"></i>
		</button>
	</div>

	<div class="table table-responsive" style="overflow-y: scroll;height:400px;">
		<table class="table table-sm">
			<thead>
				<tr class="tblhead-sm">
					<th class="text-center">Date</th>
					<th class="text-center">Ticket#</th>
					<th class="text-center">Type</th>
					<th class="text-center">Task</th>
					<th class="text-center">Status</th>
				</tr>
			</thead>
			<tbody>
				<tr class="text-xs" ng-repeat="row in historylist | limitTo:history.limit">
					<td class="text-center" style="padding: 8px">{{row.start_date_time}}</td>
					<td class="text-center" style="padding: 8px" ng-click="onSelectPrev();onSelectPrevTicket(row);">
						<u style="cursor: pointer">{{gs.getTicketNumber(row)}}</u>
					</td>
					<td class="text-center" style="padding: 8px">{{getGSHistoryType(row.type)}}</td>
					<td class="text-center" style="padding: 8px"> {{gs.getTicketNameForList(row)}}</td>
					<td class="text-center" style="padding: 8px">
						<span class="label {{gs.getStatusCssInEdit(row)}}">{{gs.getStatus(row)}}
							<i class="fa fa-pause" aria-hidden="true" ng-if="row.status_id == 1 && row.running == 0"></i>
						</span>
					</td>
				</tr>
			</tbody>
			<tfoot ng-show="history.limit < historylist.length">
				<td colspan="5" class="text-center" style="cursor: pointer;" ng-click="loadMoreGSHistory()">
					<span href="#">Load More</span>
				</td>
			</tfoot>
		</table>
	</div>
</div>

<div class="panel-default" style="border-radius: 4px">
	<div class="panel-heading">
		<label class="text-sm font-bold"></label>
		<div class="pull-left">
			<span ng-show="complaint.closed_flag == 1" class="label m-l-sm bg-wakeup-success">
				Closed 
			</span>		
			<span class="" ng-class="{'label' : true, 'm-l-sm': true,
					'bg-wakeup-pending': complaint.status == 'Pending',
					'bg-wakeup-waiting': complaint.status == 'Acknowledge',
					'bg-wakeup-success': complaint.status == 'Resolved',
					'bg-wakeup-canceled': complaint.status == 'Rejected',
					'bg-wakeup-in-progress': complaint.status == 'Forwarded',	
					'bg-complaint-ack': complaint.status == 'Unresolved',
														}">{{complaint.status}}
			</span>
		</div>	

		<button class="btn btn-sm btn-default" style="margin-top:-5px" ng-click="onCommitComment($event)" aria-hidden="false">
			<i class="fa fa-send-o" aria-hidden="true"></i>&nbsp;Comments
		</button>

		<button class="btn btn-sm btn-default" style="margin-top:-5px" ng-click="onAddFiles($event)" aria-hidden="false">
			<i class="fa fa-folder-open" aria-hidden="true"></i>&nbsp;Add Files
		</button>

		<button class="btn btn-sm btn-default" style="margin-top:-5px" ng-click="onClickServiceRecovery($event)" aria-hidden="false">
			<i class="fa fa-dollar" aria-hidden="true"></i>&nbsp;Service Rec
		</button>

		<div class="pull-right" style="margin: auto" ng-show="can_be_edit">		
			<div class="pull-left">&nbsp;&nbsp;
				<a ng-click="onDownloadPDF()">
					<i class="fa fa-file-pdf-o" style="font-size: 20px; color:red" aria-hidden="true" title="Detailed PDF download"></i>
				</a>
			</div>&nbsp;
			<button class="btn btn-sm btn-icon btn-default" style="margin-top:-5px" data-toggle="tooltip" data-placement="bottom" title="Set Reminder" ng-click="setReminder(complaint)">
				<i class="fa fa-calendar text-primary"></i>
			</button>
			<button ng-if="auth_svc.isValidModule('app.complaint.delete')" class="btn btn-sm btn-icon btn-default" style="margin-top:-5px" data-toggle="tooltip" data-placement="bottom" title="Delete" ng-click="onDelete(complaint)">
				<span class="text-danger" style="font-size: 15px;"><i class="fa fa-trash"></i></span>
			</button>

			<button ng-if="auth_svc.isValidModule('app.complaint.subcompcreate')" class="btn btn-sm btn-default" style="margin-top:-6px" ng-click="viewSubcomplaint()" aria-hidden="false">
				<i class="fa fa-plus-square-o" aria-hidden="true"></i>&nbsp;Create Sub
			</button>
			<div class="btn-group" style="margin-top:-6px" uib-dropdown is-open="status.isopen">
				<button type="button" class="btn btn-default btn-sm">
					<span class="font-bold">Status</span>
				</button>
				<button type="button" class="btn btn-default btn-sm" uib-dropdown-toggle>
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu dropdown-menu-right" role="menu">
					<li ng-click="onAckMainComplaint($event)" ng-show="auth_svc.isValidModule('app.complaint.acknowledge') && complaint.status == 'Pending'"><a href><i class="icon-like"></i>&nbsp;Acknowledge</a></li>
					<li ng-click="onReject($event)" ng-show="auth_svc.isValidModule('app.complaint.reject') && complaint.status != 'Rejected' && !(complaint.total > 0) && complaint.closed_flag != 1""><a href><i class="icon-dislike"></i>&nbsp;Reject</a></li>
					<li ng-click="onUnresolve($event)" ng-show="auth_svc.isValidModule('app.complaint.unresolve') && (exist_subcomplaint_list.length < 1 && complaint.status != 'Rejected' && complaint.status != 'Unresolved' && complaint.status == 'Acknowledge' || complaint.status == 'Closed')"><a href><i class="fa fa-window-close"></i>&nbsp;Un-resolve</a></li>
					<li ng-click="onClose($event)" ng-show="auth_svc.isValidModule('app.complaint.close') && complaint.status == 'Resolved' && complaint.completed == complaint.total && complaint.closed_flag != 1"><a href><i class="fa fa-times"></i>&nbsp;Close</a></li>
					<li ng-click="onReopen($event)" ng-show="auth_svc.isValidModule('app.complaint.reopen') && complaint.closed_flag == 1"><a href><i class="fa fa-folder-open"></i>&nbsp;Re-open</a></li>
					<li ng-click="onRepending($event)" ng-show="auth_svc.isValidModule('app.complaint.revert') && complaint.status == 'Resolved' && complaint.closed_flag != 1"><a href><i class="fa fa-step-backward"></i>&nbsp;Revert</a></li>
					<li ng-click="onResolve($event)" ng-show="complaint.status == 'Acknowledge'"><a href><i class="fa fa-lightbulb-o"></i>&nbsp;&nbsp;Resolve</a></li>							
				</ul>
			</div>
		
		</div>
	</div>
</div>	
<uib-accordion close-others="false">
<div class="wrapper" fill-height additional-padding="150" debounce-wait="5">		
	<!-- - - - - - GUEST DETAIL - - - - - -->		
	<div class="panel panel-default" style="border-radius: 4px">
		<div class="panel-heading">
			<div class="pull-left">
				<label class="font-bold text-sm"><i class="glyphicon glyphicon-user text-default"></i>&nbsp;&nbsp;Guest Detail</label>&nbsp;&nbsp;
				<span ng-click="onChangeGuest()" ng-if="auth_svc.isValidModule('app.complaint.guest_edit')"><i class="fa fa-edit"></i>&nbsp;</span>
				<a class="dropdown pos-stc" ng-show="guest_history.length > 0">
					<label ng-click="viewGuestHistory()" ng-show="guest_history.length > 0" class="text-danger font-bold text-xs"
					style="cursor: pointer"><i class="fa fa-history text-danger"></i>&nbsp;{{::guest_history.length}} Previous complaints
					</label>
				</a>
				<a class="dropdown pos-stc" ng-show="complaint.gs_guest_id > 0">
					<label ng-click="showGSHistory()" class="text-success font-bold text-xs" style="cursor: pointer">
						<i class="fa fa-history text-success"></i>&nbsp;{{historylist.length}} Guest Request(s)
					</label>
				</a>
			</div>
			
	
			
			<br>
	
		</div> 
		
		<div class="panel-body">
			
			<form class="form-horizontal form-validation" ng-submit="saveGuestProfile()">
				<div class="col-sm-3" align="center">
				<div >
					<img src="{{complaint.guest_path}}" alt="..." height="70" width="70" onError="this.onerror=null;this.src='/frontpage/img/default_photo.png';">
					<div ></div>
					<button class="btn btn-light btn-xs" ngf-select="uploadGuestImg($files)" multiple ngf-max-files="1" ngf-max-size="10MB" ngf-accept="'image/*'"
						ngf-pattern="'image/*'">
						<span class="text-success font-bold">
							Upload&nbsp;
							<i class="fa fa-upload" aria-hidden="true" title="Upload Guest Image (.jpg, .jpeg, .png with max size 10MB)"></i>
						</span>
					</button>
					
				</div>
				<div style="padding-top: 6px" ng-show="complaint.guest_type == 'In-House' || complaint.guest_type == 'Checkout'">
					<label style="padding-right: 18px"class=" text-xs text-muted">Guest VIP</label>
					<div style="padding-left: 10px">
						<label class="text-sm font-bold">{{complaint.vip}}</label>
					</div>
				</div>
			
				</div>
				<div class='col-sm-9'>
				<div class="col-sm-4">
					<label class="control-label text-xs text-muted">Guest Type</label>
					<div>
					<label class="text-sm font-bold">{{complaint.guest_type}}</label>
					</div>
				</div>
				<div class="col-sm-4">
					<label class="control-label text-xs text-muted"
						ng-hide="complaint.guest_type == 'Arrival' || complaint.guest_type == 'Walk-in'">
					{{complaint.guest_type == 'House Complaint' ? 'Type' : 'Room Number'}}
					</label>
					<div ng-hide="complaint.guest_type == 'Arrival' || complaint.guest_type == 'Walk-in'">
					<label class="text-sm font-bold">
					{{complaint.guest_type == 'House Complaint' ? complaint.house_complaint_name : complaint.room}}
					</label>
					</div>
					<label class="control-label text-xs text-muted"
						ng-show="complaint.guest_type == 'Walk-in' || complaint.guest_type == 'Arrival'">
					Name 
					</label>
					<div ng-show="complaint.guest_type == 'Walk-in' || complaint.guest_type == 'Arrival'">
					<label class="text-sm font-bold">{{complaint.guest_name}}</label>
					</div>
				</div>
				<div class="col-sm-4" ng-show="complaint.guest_type == 'In-House' || complaint.guest_type == 'Checkout'">
					<label class="control-label text-xs text-muted">Booking SRC</label>
					<div>
						<label class="text-sm font-bold">{{complaint.booking_src}}</label>
					</div>
				</div>
				<!--
				<div class="col-sm-4" ng-show="complaint.guest_type == 'Walk-in' || complaint.guest_type == 'Arrival'">
					<label class="control-label text-xs text-muted">First Name</label>
					<div>
					<label class="text-sm font-bold">{{complaint.fname}}</label>
					</div>
				</div>
			-->
				</div>
				<div class="pull-right col-sm-9" ng-show="complaint.guest_type == 'In-House' || complaint.guest_type == 'Checkout'">
				<div class="col-sm-4" >
					<label class="control-label text-xs text-muted">Name</label>
					<div>
					<label class="text-sm font-bold">{{complaint.guest_name}}</label>
					</div>
					<label class="control-label text-xs text-muted">Check-In Date</label>
					<div>
					<label class="text-sm font-bold">{{complaint.arrival | mydate}}</label>
					</div>
					<label class="control-label text-xs text-muted">Nationality</label>
					<div>
					<label class="text-sm font-bold">{{complaint.nationality_name}}</label> 
					</div>
				</div>
				<div class="col-sm-4" >
					<label class="control-label text-xs text-muted">First Name</label>
					<div>
					<label class="text-sm font-bold">{{complaint.fname}}</label> 
					</div>
					<label class="control-label text-xs text-muted">Check-Out Date</label>
					<div>
					<label class="text-sm font-bold">{{complaint.departure | mydate}}</label>
					</div>
					<label class="control-label text-xs text-muted">Email</label>
					<div>
					<label class="text-sm font-bold">{{complaint.email}}</label>
					</div>
				</div>
				<div class="col-sm-4">
					<label class="control-label text-xs text-muted">Booking Rate</label>
					<div>
						<label class="text-sm font-bold">{{complaint.booking_rate}}</label>
					</div>
					<label class="control-label text-xs text-muted">Company</label>
					<div>
						<label class="text-sm font-bold">{{complaint.company}}</label>
					</div>
					<label class="control-label text-xs text-muted">Mobile</label>
					<div>
					<label class="text-sm font-bold">{{complaint.mobile}}</label> 
					</div>
				</div>
				</div>
				
				<div class="form-group label-group"></div>
				<div uib-accordion-group is-open="complaint.guest_detail_is_open" ng-show="complaint.guest_type != 'House Complaint'">
					<uib-accordion-heading>
						<i class="fa text-danger" ng-class="{'fa-minus': complaint.guest_detail_is_open, 'fa-plus': !complaint.guest_detail_is_open}"></i>
						{{complaint.guest_detail_is_open ? 'Less Details' : 'More Details'}} 
					</uib-accordion-heading>
					<div disable-all="disable_all">
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Nationality</label>
							<div class="scrollable-dropdown-menu">
							<input type="text" ng-model="complaint.nationality_name" class="form-control input-sm"
								ng-disabled="complaint.closed_flag == 1"                         
									uib-typeahead="country.name for country in country_list | filter:$viewValue | limitTo:10"
								typeahead-editable="false"
									typeahead-min-length="0"
									typeahead-on-select="onCountrySelect($item, $model, $label)" required>
							</div>
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Passport</label>
							<input type="text" ng-model="complaint.passport" ng-disabled="complaint.closed_flag == 1" class="form-control input-sm" ng-pattern="/^(?!^0+$)[a-zA-Z0-9]{3,20}$/" maxlength="10">
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Mobile</label>
							<input type="text" ng-model="complaint.mobile" ng-disabled="complaint.closed_flag == 1" class="form-control input-sm" ng-pattern="/^([0-9\(\)\/\+ \-]*)$/" minlength="7">
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Phone</label>
							<input type="text" ng-model="complaint.phone" ng-disabled="complaint.closed_flag == 1" class="form-control input-sm" ng-pattern="/^([0-9\(\)\/\+ \-]*)$/" minlength="9">
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">E-mail</label>
							<input type="email" ng-model="complaint.email" ng-disabled="complaint.closed_flag == 1" class="form-control input-sm">
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Gender</label>
							<select class='form-control input-sm'
							ng-disabled="complaint.closed_flag == 1" 
								ng-model="complaint.gender" ng-options="type for type in genders">
							</select>
						</div>
						<div class="col-sm-12">
							<label class="control-label text-xs text-muted">Address</label>
							<input type="text" ng-model="complaint.address" ng-disabled="complaint.closed_flag == 1" class="form-control input-sm">
						</div>
						<div class="col-sm-12">
							<label class="control-label text-xs text-muted">Flag</label>
							<label class="">
							<input type="checkbox" ng-model="complaint.guest_flag" checked>
							<i></i>
							</label>
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Comment</label>
							<textarea type="text" ng-model="complaint.guest_comment" ng-disabled="complaint.guest_flag != 1" class="form-control input-sm"></textarea>
						</div>
						<div class="col-sm-6">
							<label class="control-label text-xs text-muted">Preference</label>
							<textarea type="text" ng-model="complaint.pref" ng-disabled="complaint.guest_flag != 1" class="form-control input-sm"></textarea>
						</div>
					</div>
					<div class="col-sm-12">
						<div class="form-control" style="border: none">
						<button type="submit" class="btn btn-xs m-b-xs w-xs btn-dark font-bold"
							ng-disabled="complaint.closed_flag == 1">
							<span class="text-success"><i class="fa fa-save"></i>&nbsp;Save</span>
							</button>
							<button type="button" class="btn btn-xs m-b-xs w-xs btn-dark font-bold"
							ng-disabled="complaint.guest_flag != 1" ng-click="saveGuestFlag()">
							<span class="text-success"><i class="fa fa-save"></i>&nbsp;Flag</span>
							</button>
						</div>	
					</div>                            
				</div>    
			</form>
		</div>
	</div>
	
	<!-- - - - - - /GUEST DETAIL - - - - - -->
	
	<!-- - - - - REQUESTOR DETAIL - - - - -->

		
	<!-- - - - - /REQUESTOR DETAIL - - - - -->
	
	<!-- - - - - COMPLAINT DETAIL - - - - -->
		
	<div class="panel panel-default" style="border-radius: 4px">
		<div class="panel-body" ng-click="onClickFeedbackDetail($event)">			
			<div class="row">		
				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Created at</label>
					<div class="non-edit">
						<label class="text-sm font-bold">{{complaint.created_at | mydatetime : 'D MMM YYYY hh:mm a'}}</label>
					</div>
				</div>

				<div class="col-sm-6" ng-show="property_list.length > 1">
					<label class="control-label text-xs text-muted">Property</label>
					<div>
						<label class="text-sm font-bold">{{complaint.property_name}}</label>
					</div>
				</div>

				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Severity</label>
					<div ng-show="severity_edit_flag == false" ng-click="onEditSeverity();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.severity_name}}</label>
					</div>
					<div ng-show="severity_edit_flag == true">
						<select class='form-control input-sm' ng-model="complaint.severity" ng-change="onChangedSeverity()" ng-click="$event.stopPropagation()"
							ng-options="value.id as value.type for (key, value) in severity_list" ng-disabled="complaint.closed_flag == 1"/>
					</div>
				</div>

				<div class="col-sm-6" ng-show = "can_be_edit && complaint.closed_flag != 1">
					<label class="control-label text-xs text-muted">Incident Time</label>
					<div ng-show="incident_time_edit_flag == false" ng-click="onEditIncidentTime();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.incident_time | mydatetime}}</label>
					</div>
					<div ng-show="incident_time_edit_flag == true" class="dropdown">
						<a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#">
							<div class="input-group">
								<input type="text" class="form-control" ng-model="complaint.incident_time" ng-click="$event.stopPropagation()">
								<span class="input-group-addon non-edit"><i class="glyphicon glyphicon-calendar"></i></span>
							</div>
						</a>
						<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
							<datetimepicker ng-model="complaint.timepicker" data-datetimepicker-config="{ dropdownSelector: '#dropdown2', startView: 'hour' }"
							data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)"/>
						</ul>
					</div>
				</div>		

				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Type</label>
					<div ng-show="feedback_type_edit_flag == false" ng-click="onEditFeedbackType();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.feedback_type}}</label>
					</div>
					<div ng-show="feedback_type_edit_flag == true">
						<select class='form-control input-sm' ng-model="complaint.feedback_type_id" ng-click="$event.stopPropagation()" 
							ng-change="onFeedbackTypeSelect(complaint)"
							ng-options="value.id as value.name for (key, value) in feedback_type_list"/>
					</div>
				</div>

				<div class="col-sm-6" ng-show = "can_be_edit && complaint.closed_flag != 1">
					<label class="control-label text-xs text-muted">Source</label>
					<div ng-show="feedback_source_edit_flag == false" ng-click="onEditFeedbackSource();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.feedback_source}}</label>
					</div>
					<div ng-show="feedback_source_edit_flag == true">
						<select class='form-control input-sm' ng-model="complaint.feedback_source_id" 
							ng-change="onFeedbackSourceSelect(complaint)"
							ng-click="$event.stopPropagation()"
							ng-options="value.id as value.name for (key, value) in feedback_source_list"/>
					</div>
				</div>

			
				<div class="col-sm-6" >
					<label class="control-label text-xs text-muted">Location</label>
					<div ng-show="location_edit_flag == false" ng-click="onEditLocation();$event.stopPropagation();">
						<label class="text-sm font-bold">{{::complaint.lgm_name}} - {{::complaint.lgm_type}}</label>
					</div>
					<div class="scrollable-dropdown-menu" ng-show="location_edit_flag == true">
						<input type="text"  ng-click="$event.stopPropagation()" ng-model="complaint.lgm_name" class="form-control input-sm" placeholder="Enter location name"
							uib-popover="Enter location name" popover-trigger="mouseenter"
							uib-typeahead="room.room for room in location_list | filter:$viewValue"
							typeahead-min-length="0"
							typeahead-editable="false"
							typeahead-template-url="locationTypeahead.html"
							typeahead-on-select="onMainLocationSelect($item, $model, $label)" required>
					</div>
				</div>
				
				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Requestor</label>
					<div>
						<label class="text-sm font-bold">{{complaint.wholename}}</label>
					</div>
				</div>
				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Job Role</label>
					<div>
						<label class="text-sm font-bold">{{complaint.design}}</label>
					</div>
				</div>
				
				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Category</label><br>
					<div class="col-sm-10" style="padding-bottom:10px; padding-left: 0px" ng-show="category_edit_flag == false" ng-click="onEditCategory();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.category_name}}</label>
					</div>
					<div class="col-sm-10" style="padding-bottom:10px; padding-left: 0px" ng-show="category_edit_flag == true">
						<select class='form-control input-sm' ng-model="complaint.category_id" ng-change="onChangedCategory()"
							ng-click="$event.stopPropagation()"
							ng-options="value.id as value.name for (key, value) in category_list"/>
					</div>							
					<div class="col-sm-2">
						<i class="fa fa-plus-circle fa-2x text-danger " style="cursor: pointer"
							title="Create Category" ng-click="createCategory()" ng-show="category_editable"></i>
					</div>			
				</div>

				<div class="col-sm-6">
					<label class="control-label text-xs text-muted">Sub Category</label><br>
					<div class="col-sm-10" style="padding-bottom:10px; padding-left: 0px" ng-show="subcategory_edit_flag == false" ng-click="onEditSubCategory();$event.stopPropagation();">
						<label class="text-sm font-bold">{{complaint.subcategory_name}}</label>
					</div>
					<div class="col-sm-10" style="padding-bottom:10px; padding-left: 0px" ng-show="subcategory_edit_flag == true">
						<select class='form-control input-sm' ng-model="complaint.subcategory_id" ng-change="onChangedSubCategory()"
							ng-click="$event.stopPropagation()"
							ng-options="value.id as value.name for (key, value) in main_subcategory_list"/>
					</div>							
					<div class="col-sm-2">
						<i class="fa fa-plus-circle fa-2x text-danger " style="cursor: pointer"
							title="Create Sub Category" ng-click="createMainSubCategory()" ng-show="category_editable"></i>
					</div>			
				</div>
				

				<div class="col-sm-12">
					<label class="control-label text-xs text-muted">Department</label><br>
					<div class="col-sm-11" style="padding-left: 0px;margin-bottom : 10px;">
						<tags-input ng-model="selected_depts" placeholder="Add Department" replace-spaces-with-dashes="false" style="margin-top: -5px"
							display-property="department" key-property="id"
							>
							<auto-complete source="loadFiltersValue('Department',$query)"
								min-length="0"
								debounce-delay="0"
								load-on-focus="true"
								load-on-empty="true"
								max-results-to-show="100">
							</auto-complete>
						</tags-input>
					</div> 
				
					<div class="col-sm-1 pull-right">
						<button class="btn btn-rounded btn btn-icon btn-default" style="cursor: pointer" ng-if="selected_depts.length > 0" ng-click="onDepartmentSend()">
							<i class="fa fa-save" style="color: #0d47a1"></i>
						</button>
					</div>
				</div>

				<div class="col-sm-12">
					<label class="control-label text-xs text-muted">Feedback</label><br>
					<div  ng-show = "complaint.closed_flag != 1" class="control-label form-horizontal col-sm-12 text-sm font-bold" style="text-align: left;margin-bottom : 10px;padding-bottom:10px; padding-left: 0px; display: inline-block; max-width: 85vh; overflow-wrap: break-word; overflow-x: hidden;">
						<div ng-bind-html="complaint.comment" ng-click="editFeedback(complaint);$event.stopPropagation();" ng-show="feedback_edit_flag == false"></div>	
						<div inline-text-editor ng-model="complaint.comment" class="inline-text-editor" ng-click="$event.stopPropagation();" ng-show="feedback_edit_flag == true" contentEditable></div>	
						<button type="button" class="btn btn-info btn-xs w-xxs" ng-click="changeFeedback(complaint)" ng-show="feedback_edit_flag == true">
							<span class="glyphicon glyphicon-ok"></span>
							<b> Save</b>
						</button>
						<button type="button" class="btn btn-default btn-xs w-xxs" data-dismiss="modal" ng-click="cancelFeedback(complaint)" ng-show="feedback_edit_flag == true">
							<span class="glyphicon glyphicon-remove"></span>
							<b> Cancel</b>
						</button>
					</div>
					<div ng-show = 'complaint.closed_flag == 1'>
						<div class="col-sm-11 text-sm font-bold" style="padding-bottom:10px; padding-left: 0px; display: inline-block; max-width: 85vh; overflow-wrap: break-word; overflow-x: hidden;margin-bottom : 10px;" highlight="complaint.comment_response"
							keywords="complaint.comment_highlight" quick-edit ng-model="complaint.comment_changed" on-text-select="comment_highlight($text)" contenteditable="false">
						</div>
						<div class="col-sm-1 pull-right">
							<a ng-click="clearCommentHighlight()"><i class="fa fa-eraser" title="Remove Highlight" style="color: #1B5E20" aria-hidden="true"></i></a>
						</div>	
					</div>	
				</div>
				<div class="col-sm-12">
					<label class="control-label text-xs text-muted">Initial Response</label><br>
					<div  ng-show = "can_be_edit && complaint.closed_flag != 1" class="control-label form-horizontal col-sm-12 text-sm font-bold" style="text-align: left;padding-bottom:10px; padding-left: 0px; display: inline-block; max-width: 85vh; overflow-wrap: break-word; overflow-x: hidden;margin-bottom : 10px;">	
						<div ng-bind-html="complaint.initial_response" ng-click="editInitialResponse(complaint);$event.stopPropagation();" ng-show="initial_response_edit_flag == false"></div>	
						<div inline-text-editor ng-model="complaint.initial_response" ng-click="$event.stopPropagation();" class="inline-text-editor" ng-show="initial_response_edit_flag == true" contentEditable></div>		

						<button type="button" class="btn btn-info btn-xs w-xxs" ng-click="changeInitialResponse(complaint)" ng-show="initial_response_edit_flag == true">
							<span class="glyphicon glyphicon-ok"></span>
							<b> Save</b>
						</button>
						<button type="button" class="btn btn-default btn-xs w-xxs" data-dismiss="modal" ng-click="cancelInitialResponse(complaint)" ng-show="initial_response_edit_flag == true">
							<span class="glyphicon glyphicon-remove"></span>
							<b> Cancel</b>
						</button>
					</div>
					<div ng-show = '!can_be_edit || (can_be_edit && complaint.closed_flag == 1)'>
						<div class="col-sm-11 text-sm font-bold" style="padding-bottom:10px; padding-left: 0px;margin-bottom : 10px;" highlight="complaint.response" keywords="complaint.response_highlight" quick-edit ng-model="complaint.response_changed" on-text-select="response_highlight($text)" contenteditable="false">
						</div>
						<div class="col-sm-1">
							<a ng-click="clearCommentHighlight()"><i class="fa fa-eraser" title="Remove Highlight" style="color: #1B5E20" aria-hidden="true"></i></a>
						</div>
					</div>
				</div>	<br>	
				<div class="col-sm-12" ng-show = "complaint.status == 'Resolved'">
					<label class="control-label text-xs text-muted">Resolution</label><br>
					<div  ng-show = "complaint.closed_flag != 1" class="control-label form-horizontal col-sm-12 text-sm font-bold" style="text-align: left;padding-bottom:10px; padding-left: 0px; display: inline-block; max-width: 85vh; overflow-wrap: break-word; overflow-x: hidden;margin-bottom : 10px;">	
						<div ng-bind-html="complaint.solution" ng-click="editResolution(complaint);$event.stopPropagation();" ng-show="solution_edit_flag == false"></div>	
						<div inline-text-editor ng-model="complaint.solution" class="inline-text-editor" ng-show="solution_edit_flag == true" contentEditable></div>		

						<button type="button" class="btn btn-info btn-xs w-xxs" ng-click="changeResolution(complaint)" ng-show="solution_edit_flag == true">
							<span class="glyphicon glyphicon-ok"></span>
							<b> Save</b>
						</button>
						<button type="button" class="btn btn-default btn-xs w-xxs" data-dismiss="modal" ng-click="cancelResolution(complaint)" ng-show="solution_edit_flag == true">
							<span class="glyphicon glyphicon-remove"></span>
							<b> Cancel</b>
						</button>
					</div>
					<div ng-show = "complaint.closed_flag">
						<div class="col-sm-12 text-sm font-bold" style="padding-bottom:10px; padding-left: 0px;margin-bottom : 10px;" highlight="complaint.solution" contenteditable="false">
						</div>		
					</div>
				</div>					
				<div class="col-sm-12" ng-show="complaint.closed_flag">
					<label class="control-label text-xs text-muted">Root Cause</label>
					<div style = "margin-bottom : 10px">
						<label class="text-sm font-bold">{{complaint.closed_comment}}</label>
					</div>
				</div>		
				<div class="col-sm-12">
					<label class="control-label text-xs text-muted">Attachments</label>
					<div style = "margin-bottom : 10px">						
						<a ng-repeat="path in complaint.download_array" style="position:relative" download>								
							<img style="width:auto;height:50px;" src = "/{{path}}" ng-if="!complaint.pdf_type_flag[$index]" ng-click="openModalImage(path, path);$event.stopPropagation();" />
							<i class="fa {{complaint.icon_class[$index]}}" style="font-size: 20px; color:red; margin-right: 15px; vertical-align: middle;" ng-if="complaint.pdf_type_flag[$index]" ng-click="downloadFile(path);$event.stopPropagation();"></i>								
							<span class="glyphicon icon-close" style="color: red; position: absolute;top:120%;right:0;" 
								ng-if="auth_svc.isValidModule('app.complaint.delete')"
                                ng-click="removeFile($index)">
                            </span>
						</a>
						<a ng-if="complaint.download_array.length < 1" style="font-style: italic; font-size: 10px">No Attachment</a>
					</div>
				</div>
				
				
			</div>

			<!-- Tab -->
	<div class="tab-bar">
		<label class="text-sm font-bold"></label>
		<button class="btn btn-sm" ng-class="{'btn-dark': tab_index == 1, 'btn-link': tab_index != 1}" ng-click="onSelectServiceRecovery()">
			Service Recovery
		</button>

		<button class="btn btn-sm" ng-class="{'btn-dark': tab_index == 2, 'btn-link': tab_index != 2}" ng-hide ="complaint.closed_flag == 1 || complaint.status == 'Rejected' || !auth_svc.isValidModule('app.complaint.subcompcreate')" ng-click="onSelectSubcomplaint()">
			Dept Actions
		</button>

		<button class="btn btn-sm" ng-class="{'btn-dark': tab_index == 3, 'btn-link': tab_index != 3}" ng-click="onSelectComments()">
			Comments
		</button>

		<button class="btn btn-sm" ng-class="{'btn-dark': tab_index == 4, 'btn-link': tab_index != 4}" ng-click="onSelectHistory()">
			History
		</button>
	</div>

	<!-- - - - - - COMPENSATION PANEL - - - - - -->
								
	<div ng-show="tab_index == 1" class="clearfix m-b-lg"
		style="border-radius: 4px; margin-bottom: 10px" >
		<!--
		<div class="panel-heading">
			<label class="text-sm font-bold"><i class="fa fa-dollar text-default"></i>&nbsp;&nbsp;Service Recovery</label>

			<a ng-click="onGenerateCompensationPDF()">
				<i class="fa fa-file-pdf-o" style="font-size: 20px; color:red; margin-left: 5px; vertical-align: middle;" aria-hidden="true" title="Detailed PDF download"></i>
			</a>
		</div>
	-->
		<div >


			<div class="table table-responsive" ng-show="comp_list.length > 0">					
				<table  st-table="ticketlist" class="table ticket table-striped b-t b-light">
					<thead class="tblhead-sm" style="font-size: 12px">
						<tr>
							<th class="text-center"><b>Item Type</b></th>
							<th class="text-center"><b>Cost</b></th>
							<th class="text-center"><b>Provider</b></th>
							<th class="text-center" ><b>Comment</b></th>
							<th class="text-center"><b>Approval</b></th>
							<th class="text-center" ng-show="auth_svc.isValidModule('app.complaint.maincomplaint_comp_delete')"><b>Action</b></th>
						</tr>
					</thead>
					<tbody style="font-size: 12px">
						<tr ng-repeat="row1 in comp_list" ng-click="showCompensationDetail(row1)">
							<td class="text-center"><span>{{::row1.item_name}}</span></td>
							<td class="text-right" style="padding-right: 30px"><span>AED {{::row1.cost}}</span></td>
							<td class="text-center"><span>{{::row1.provider}}</span></td>
							<td class="text-center"><span>{{::row1.comment}}</span></td>
							<td class="text-center">
								<span style="font-size: 11px" ng-class="{'label' : true, 'm-l-sm': true,
											'bg-wakeup-pending': row1.status == '1',
											'bg-wakeup-waiting': row1.status == '2',
											'bg-wakeup-success': row1.status == '0',
											'bg-wakeup-no-answer': row1.status == '3',
											'bg-wakeup-snooze': row1.status == '4',
											'bg-wakeup-failed': row1.status == '5',                                  
											}">
									{{row1.status == 0 ? 'Complete Approved' : ''}}
									{{row1.status == 1 ? 'On-route' : ''}}
									{{row1.status == 2 ? 'Rejected' : ''}}
									{{row1.status == 3 ? 'Returned' : ''}}
									{{row1.status == 4 ? 'Pending' : ''}}
								</span>
							</td>
							<td class="text-center" ng-show="auth_svc.isValidModule('app.complaint.maincomplaint_comp_delete')">
								<span class="fa-stack text-danger" ng-click="deleteMainCompensation(row1); $event.stopPropagation();">
									<i class="fa fa-times fa-stack-1x" style="font-size:.7vw"> </i>
								</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>					    	
		</div>
	</div>
							
	<!-- - - - - - /COMPENSATION PANEL - - - - - -->
				
	<!-- - - - - - SUBCOMPLAINTS - - - - - -->
								
	<div ng-show="tab_index == 2" style="margin-bottom: 10px">
		<div class="text-center" ng-show="exist_subcomplaint_list.length < 1">
			<button class="btn btn-sm btn-default" style="margin-top:-6px"  ng-hide ="complaint.closed_flag == 1 || complaint.status == 'Rejected' || !auth_svc.isValidModule('app.complaint.subcompcreate')" ng-click="viewSubcomplaint()" aria-hidden="false">
				<i class="fa fa-plus-square-o" aria-hidden="true"></i>&nbsp;Create Sub
			</button>
		</div>
		<div ng-repeat="sub in exist_subcomplaint_list" style="margin-top: 10px">
			<div style="width: 95%;" class="col-centered wrapper-xs">
				<form class="bs-example form-horizontal">
					<div class="row form-horizontal">
						<label class="font-bold text-sm">
							<i class="icon-energy"></i>
							&nbsp;&nbsp;{{::sub.ticket_no}} - {{::sub.department}}
						</label>

						&nbsp;&nbsp;
						<label><i class="fa fa-clock-o"></i> {{::sub.age_days}}</label>&nbsp;

						<div class="btn-group dropdown">
							<button class="btn btn-default btn-sm" data-toggle="dropdown" aria-expanded="false">
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu w1" aria-labelledby="single-button">
								<li ng-click="onAck(sub);" ng-show="sub.ack != 1 && sub.status != 2 && sub.status != 7">
									<a href=""><label>Acknowledge</label></a>
								</li>								
								<li ng-click="onComplete(sub)" ng-hide="sub.status == 2 || sub.status == 5">
									<a href=""><label>Complete</label></a>
								</li>
								<li ng-click="onCancel(sub)" ng-hide="sub.status >= 0">
									<a href=""><label>Cancel</label></a>
								</li>	
								<li ng-click="onReopensub(sub)" ng-show="sub.status == 2">
									<a href=""><label>Re-Open</label></a>
								</li>
								<li ng-if="auth_svc.isValidModule('app.complaint.subcompdelete')"  ng-click="onDeletesub(sub)">
									<a href=""><label>Delete</label></a>
								</li>												
							</ul>
						</div>
							
								
						

						<div class="pull-right">
							<span ng-class="{'label' : true, 'm-l-sm': true,
										'bg-wakeup-pending': sub.status == '1',
										'bg-wakeup-waiting': sub.status == '2',
										'bg-wakeup-success': sub.status == '3',
										'bg-wakeup-no-answer': sub.status == '4',
										'bg-wakeup-failed': sub.status == '5',                                  
										'bg-wakeup-canceled': sub.status == '6',
										'bg-all': sub.status == '7',
										}" style="font-size: 65%">
										{{sub.status == 1 ? 'Pending' : ''}}
										{{sub.status == 2 ? 'Completed' : ''}}
										{{sub.status == 3 ? 'Escalated' : ''}}
										{{sub.status == 4 ? 'Re-routing' : ''}}
										{{sub.status == 5 ? 'Canceled' : ''}}
										{{sub.status == 6 ? 'Timeout' : ''}}
										{{sub.status == 7 ? 'Re-opened' : ''}}
							</span>								
						</div>
						
					</div>
				</form>
			</div>
			<div class="form-horizontal" ng-click="onClickSubcomplaintPanel($event, sub)">  
		
				<div class="label-group col-sm-12">
					<div class="col-sm-2 my-control-label text-muted">Department</div>
					<div class="col-sm-4"><strong><p>{{::sub.department}}</p></strong></div>                        
					<div class="col-sm-2 my-control-label text-muted">Severity</div>
					<div class="col-sm-4"><strong><p>{{::sub.type}}</p></strong></div>
				</div>

				<div class="label-group col-sm-12">
					<div>
						<label class="col-sm-2 control-label text-muted">Category</label>
						<div ng-hide="sub.subc_category_edit_flag" 
							ng-click="onEditSubcomplaintCategory(sub);$event.stopPropagation();"
							class="col-sm-4 my-control-label font-bold sub-label">
							{{sub.category_name}}
						</div>
						<div ng-show="sub.subc_category_edit_flag" class="col-sm-4 scrollable-dropdown-menu">
							<input class="form-control input-sm col-sm-11" type="text" ng-model="sub.category_name"                   
								ng-click="$event.stopPropagation()"
								uib-typeahead="category.name for category in sub_category_list | filter:$viewValue | limitTo:10"
								typeahead-min-length="0"
								typeahead-editable="false" 
								typeahead-on-select="onsubcompCategorySelect($item, $model, $label, sub)" required>
						</div>
					</div>
					<div ng-show = 'category_change == true && complaint.closed_flag != 1'>
						<label class="col-sm-2 control-label text-muted">Sub Category</label>
						<div ng-hide="sub.subc_subcategory_edit_flag" 
							ng-click="onEditSubcomplaintSubCategory(sub);$event.stopPropagation();"
							class="col-sm-4 my-control-label font-bold sub-label">
							{{sub.subcategory_name}}
						</div>
						<div class="col-sm-4 scrollable-dropdown-menu" ng-show="sub.subc_subcategory_edit_flag" >
							<input class="form-control input-sm col-sm-11" type="text" ng-model="sub.subcategory_name"                     
								ng-click="$event.stopPropagation()"
								uib-typeahead="subcategory.name for subcategory in sub_subcategory_list | filter:$viewValue | limitTo:10"
								typeahead-min-length="0"
								typeahead-editable="false"
								typeahead-on-select="onsubSubcategorySelect($item, $model, $label,sub)">
						</div>
					</div>
				</div>

				
				<div class="label-group col-sm-12" ng-show="sub.location_id > 0">				
					<div>
						<div class="col-sm-2 control-label text-muted">Location</div>
						<div ng-hide="sub.subc_location_edit_flag" 
							ng-click="onEditSubcomplaintLocation(sub);$event.stopPropagation();"
							class="col-sm-4 my-control-label font-bold sub-label">
							{{sub.location_name}}
						</div>
						<div class="col-sm-4 scrollable-dropdown-menu" ng-show="sub.subc_location_edit_flag" >
							<input type="text" ng-model="sub.location_name" class="form-control input-sm" placeholder="Enter location name"
								ng-click="$event.stopPropagation()"
								uib-typeahead="room.room for room in dept_loc_list | filter:$viewValue | limitTo:10"
								typeahead-min-length="0"
								typeahead-editable="false"
								typeahead-template-url="locationTypeahead.html"
								typeahead-on-select="onsubLocationSelect($item, $model, $label,sub)" required>								
						</div>
					</div>
					
					<div>	
						<label class="col-sm-2 control-label text-muted">Location Type</label>
						<div class="col-sm-4 my-control-label font-bold sub-label">
							{{sub.location_type}}
						</div>						
					</div> 
				</div>

					

				<div class="label-group col-sm-12" ng-show="sub.compensation_id > 0">
					<div class="col-sm-2 my-control-label text-muted">Service Recovery</div>
					<div class="col-sm-4"><strong><p>{{::sub.compensation_name}} - AED {{::sub.cost}}</p></strong></div>                        
					<div class="col-sm-2 my-control-label text-muted">Provider</div>
					<div class="col-sm-4"><strong><p>{{::sub.sub_provider}}</p></strong></div>
				</div>
				
				<div class="label-group col-sm-12">
					<div class="col-sm-2 my-control-label text-muted">Created At</div>
					<div class="col-sm-4"><strong><p>{{::sub.created_at | mydatetime : 'D MMM YYYY hh:mm a'}}</p></strong></div>                        
					<div class="col-sm-2 my-control-label text-muted">Created By</div>
					<div class="col-sm-4"><strong><p>{{::sub.created_by}}</p></strong></div>                        		
				</div>

				<div class="col-sm-12 label-group">
					<div class="col-sm-2 control-label text-muted">Comment</div>
					<div class="col-sm-10 control-label" ng-hide="sub.comment_edit_flag" style="text-align: left" ng-click="editSubcomment(sub);$event.stopPropagation();">
						<strong>{{sub.comment}}</strong>
					</div>			
					<div class="control-label form-horizontal col-sm-10" ng-show="sub.comment_edit_flag" style="text-align: left">	
						<textarea class="form-control input-sm"
							ng-click="$event.stopPropagation();"
							rows="2" ng-model="sub.comment" style=" resize:none"></textarea>											
						<button type="button" class="btn btn-info btn-xs w-xxs" ng-click="changesubComment(sub)">
							<span class="glyphicon glyphicon-ok"></span>
							<b> Save</b>
						</button>
						<button type="button" class="btn btn-default btn-xs w-xxs" data-dismiss="modal" ng-click="cancelSubComment(sub)">
							<span class="glyphicon glyphicon-remove"></span>
							<b> Cancel</b>
						</button>
					</div>
				</div>
				

				<div class="label-group col-sm-12" style="margin-bottom: 10px">
					<div class="col-sm-2 my-control-label text-muted">Initial Response</div>
					<div class="col-sm-10"><strong><p>{{::sub.init_response}}</p></strong></div>
				</div>  
		

				<div class="col-sm-12 label-group"  ng-if="sub.status == 2">
					<div class="col-sm-2 control-label text-muted">Resolution</div>
					<div class="col-sm-10 control-label" ng-hide="sub.resolution_edit_flag" style="text-align: left" ng-click="editSubResolution(sub);$event.stopPropagation();">
						<strong>{{sub.resolution}}</strong>
					</div>			
					<div class="control-label form-horizontal col-sm-10" ng-show="sub.resolution_edit_flag" style="text-align: left">	
						<textarea class="form-control input-sm"
							ng-click="$event.stopPropagation();"
							rows="2" ng-model="sub.resolution" style=" resize:none"></textarea>											
						<button type="button" class="btn btn-info btn-xs w-xxs" ng-click="changesubSolution(sub)">
							<span class="glyphicon glyphicon-ok"></span>
							<b> Save</b>
						</button>
						<button type="button" class="btn btn-default btn-xs w-xxs" data-dismiss="modal" ng-click="cancelSubResolution(sub)">
							<span class="glyphicon glyphicon-remove"></span>
							<b> Cancel</b>
						</button>
					</div>	
				</div>

				<div class="label-group col-sm-12" ng-if="sub.status == 2"> 
					<div class="col-sm-2 my-control-label text-muted">Completed By</div>
					<div class="col-sm-4"><strong><p>{{::sub.completed_by_name}}</p></strong></div>            
					<div class="col-sm-2 my-control-label text-muted">Completed Date</div>
					<div class="col-sm-4"><strong><p>{{::sub.completed_at | mydatetime}}</p></strong></div>            
				</div>
					
				<div class="label-group col-sm-12">
					<div class="col-sm-2 my-control-label text-muted">Download</div>
					<div class="col-sm-10">
						<a ng-repeat="path in sub.sub_download_array" style="position:relative" download>								
							<img style="width:auto;height:50px;" src = "/{{path}}" ng-if="!sub.sub_pdf_type_flag[$index]" ng-click="openModalImage(path, path);$event.stopPropagation();" />
							<i class="fa fa-minus-circle text-danger " style="cursor: pointer; position: absolute; bottom: -20px;right:0"  ng-click="deletefileForSubcomplaint(sub, $index)"></i>
							<i class="fa {{sub.sub_icon_class[$index]}}" style="font-size: 20px; color:red; margin-right: 15px; vertical-align: middle;" ng-if="sub.sub_pdf_type_flag[$index]" ng-click="downloadFile(path);$event.stopPropagation();"></i>								
						</a>			        		
						<a ng-if="sub.sub_download_array.length < 1" style="font-style: italic;">No Attachment</a>  
					</div>
				</div>       
			</div>

			<div class="line"></div>
		
			<div class="" style="margin: 0px 20px 0px 20px" ng-show="sub.comment_list.length > 0">
				<uib-accordion close-others="false">  
					<div uib-accordion-group class="panel-default" is-open="sub.comment_is_open">
						<uib-accordion-heading>
							<i class="fa fa-comment"></i>&nbsp;Comments
							<i class="pull-right glyphicon"
								ng-class="{'glyphicon-chevron-down': sub.comment_is_open, 'glyphicon-chevron-right': !complaint_comment_is_open}"></i>
						</uib-accordion-heading>
						<!-- .comment-list  -->
						<div class="m-b b-l m-l-md streamline">
							<div ng-repeat="row in sub.comment_list" style="margin-bottom: 15px">
								<a class="pull-left thumb-sm avatar m-l-n-md" style="padding-left: px">
									<img src="{{::row.picture}}" width="30" height="30">
								</a>          
								<div class="m-l-lg panel b-a">
									<div class="panel-heading pos-rlt b-b b-light" style="background-color: #fff; border-bottom: 1px solid #dee5e7">
										<span class="arrow left"></span>
										<a href="">{{::row.wholename}}</a>
										<label class="label bg-primary m-l-xs">{{::row.job_role}}</label> 
										<span class="text-muted text-sm m-l-sm pull-right">
											<i class="fa fa-clock-o"></i>
												{{::row.time}}
										</span>
									</div>
									<div class="panel-body">
										<div ng-bind-html="row.comment"></div>
									</div>
								</div>
							</div>
						</div>  

						<div class="clearfix m-b-lg" ng-model="complaint.sub_comment" disable-all="disable_all">
							<div class="pull-left">
								<button type="button" class="btn btn-default">
									<span class="glyphicon glyphicon-user"></span>
								</button>
							</div>
							<div class="m-l-xxl" ng-submit="postReply(sub, sub.sub_reply)">
								<form class="m-b-none">
									<div class="input-group">
										<input type="text" focus-me="true" ng-model="sub.sub_reply"
											class="form-control input-sm" placeholder="Input your reply here" required>
										<span class="input-group-btn">
											<button class="btn btn-sm m-b-xs w-xs btn-dark font-bold" type="submit">
												<span	class="text-info"><i class="fa fa-send-o" aria-hidden="true"></i>&nbsp;Post</span>
											</button>
										</span>
									</div>
								</form>
							</div>
						</div>
					</div> 
				</uib-accordion>	
			</div>

			<div class="panel panel-default" style="border-radius: 4px; margin-bottom: 10px" >
				<div class="panel-heading">
					<label class="text-sm font-bold"><i class="fa fa-dollar text-default"></i>&nbsp;&nbsp;Service Recovery</label>
					<div class="pull-right">
						<span>Total: AED {{sub.compensation_total}}</span> 
					</div> 
				
				</div>
				<div class="panel-body">
					<div>
						<div class="row">
							<div class="col-sm-6">
								<div class="scrollable-dropdown-menu">
									<input ng-model="sub.comp.compensation" class="form-control  input-sm"
										placeholder="Compensation"
										ng-focus="onFocus($event)" empty-typeahead
										uib-typeahead="item.compensation for item in compensations | filter:$viewValue:stateComparator"
										typeahead-min-length="0"
										typeahead-on-select="onSubCompensationSelect(sub, $item, $model, $label)"
										typeahead-no-results="sub.no_compensation" required/>
								</div>  
							</div>   

							<div class="col-sm-2">
								<input type="text" ng-model="sub.comp.cost" placeholder="Cost" class="form-control input-sm">
							</div>         
							<div class="col-sm-3">
								<div class="scrollable-dropdown-menu">
									<input ng-model="sub.comp.sub_provider" class="form-control  input-sm"
										placeholder="Provided By"
										ng-focus="onFocus($event)" empty-typeahead
										uib-typeahead="user.wholename for user in staff_list | filter:$viewValue | limitTo:10"
										typeahead-min-length="0"
										typeahead-on-select="onSubProviderSelect(sub, $item, $model, $label)"
										typeahead-no-results="sub.no_staff" required/>
								</div>  
							</div>   

							<div class="col-sm-1">
								<i class="fa fa-plus-circle fa-2x text-danger " style="cursor: pointer"
									title="Add Compensation" ng-click="onAddSubCompensation(sub)"></i>
							</div>
						</div>					
					
					</div>
					<div class="table table-responsive" style="margin-top: 6px">
						<table  st-table="ticketlist" class="table ticket table-striped b-t b-light">
							<thead class="tblhead-sm" style="font-size: .7vw">
								<tr>
									<th class="text-center"><b>No</b></th>
									<th class="text-center"><b>Compensation</b></th>
									<th class="text-center"><b>Cost</b></th>
									<th class="text-center"><b>Provided By</b></th>
									<th class="text-center"><b>Date & Time</b></th>		
									<th class="text-center" ng-show="auth_svc.isValidModule('app.complaint.subcomplaint_comp_delete')">
										<b>Action</b>
									</th>												 
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="row in sub.compensation_list">
									<td class="text-center"><span>{{$index + 1}}</span></td>
									<td class="text-center"><span>{{row.compensation}}</span></td>
									<td class="text-center"><span>{{row.cost}}</span></td>                
									<td class="text-center"><span>{{row.wholename}} {{row.department}}</span></td>								
									<td class="text-center"><span>{{row.created_at | mydatetime : 'D MMM YYYY hh:mm'}}</span></td>																		
									<td class="text-center" ng-show="auth_svc.isValidModule('app.complaint.subcomplaint_comp_delete')">
										<span class="fa-stack text-danger" ng-click="onDeleteSubCompensation(row); $event.stopPropagation();">
											<i class="fa fa-times fa-stack-1x" style="font-size:.7vw"> </i>
										</span>
									</td>
								</tr>									
							</tbody>
						</table>
					</div>		    	
				</div>
			</div>

			<div><b>Sub-complaint logs</b>
			</div>
			<div>
				<div class="table table-responsive">
					<table  class="table ticket table-striped b-t b-light">
						<thead class="tblhead-sm" style="font-size: .7vw">
							<tr>
								<th class="text-center"><b>Date & Time</b></th>
								<th class="text-center"><b>Action</b></th>
								<th class="text-center"><b>User</b></th>																	
							</tr>
						</thead>
						<tbody style="font-size: 12px">
							<tr ng-repeat="row1 in sub.log_list">
								<td align="center" ><span>{{::row1.created_at_time | mydatetime : 'D MMM YYYY'}}</span></td>
								<td align="center" ><span>{{::row1.comment}}</span></td>
								<td align="center" ><span>{{::row1.wholename}}</span></td>																	
							</tr>
							<tr ng-show="sub.log_list.length < 1">
								<td colspan="3" align="center">There is no history</td>								
							</tr>
						</tbody>
					</table>
				</div>
			</div>

			<div class="line line-dashed b-b line-lg"></div>
		</div> 
	</div> 
				
	<!-- - - - - - /SUBCOMPLAINTS - - - - - -->
				
	<!-- - - - - - COMMENTS - - - - - -->
	<div ng-show="tab_index == 3" style="margin-bottom: 10px">					
		<div class="m-b b-l m-l-md streamline">
			<div ng-repeat="row in comment_list" style="margin-bottom: 15px">
				<object class="pull-left thumb-sm avatar m-l-n-md" data="/frontpage/img/default_photo.png" style="padding-left: 0px" type="image/png">
					<img src="{{::row.picture}}" width="30" height="30">
				</object>          
				<div class="m-l-lg panel b-a">
					<div class="panel-heading pos-rlt b-b b-light" style="background-color: #fff; border-bottom: 1px solid #dee5e7">
						<span class="arrow left"></span>
						<a href="">{{::row.wholename}}</a>
						<label class="label bg-primary m-l-xs">{{::row.job_role}}</label> 
						<span class="text-muted text-sm m-l-sm pull-right">
							<i class="fa fa-clock-o"></i>
							{{::row.time}}
						</span>
					</div>
					<div class="panel-body" style="padding:5px">
						<div ng-bind-html="row.comment" ng-hide="row.edit_flag"></div>
						<textarea type="text" ng-show="row.edit_flag" ng-model="row.comment" class="form-control input-sm"></textarea>
						<div ng-hide="row.edit_flag">
							<button class="btn btn-sm btn-link" ng-click="onEditComment(row)">
								Edit
							</button>
							<button class="btn btn-sm btn-link" ng-click="onDeleteComment(row)">
								Delete
							</button>
						</div>

						<div ng-show="row.edit_flag">
							<button class="btn btn-xs btn-info" ng-click="onSaveComment(row)">
								Save
							</button>
							<button class="btn btn-sm btn-link" ng-click="onCancelComment(row)">
								Cancel
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
						
	<div class="clearfix m-b-lg"  ng-show="tab_index == 4">
		<div class="table table-responsive">
			<table  st-table="ticketlist" class="table ticket table-striped b-t b-light">
				<thead class="tblhead-sm" style="font-size: .7vw">
					<tr>
						<th class="text-center" style = "width : 20%"><b>Date & Time</b></th>
						<th class="text-center" style = "width : 60%"><b>Action</b></th>
						<th class="text-center" style = "width : 20%"><b>User</b></th>								
					</tr>
				</thead>
				<tbody style="font-size: 12px">
					<tr ng-repeat="row1 in log_list">
						<td align="center" ><span>{{::row1.created_at_time}}</span></td>
						<td align="center" ><div ng-bind-html="row1.comment"></div></td>
						<td align="center" ><span>{{::row1.wholename}}</span></td>								
					</tr>
					<tr ng-show="log_list.length < 1">
						<td colspan="3" align="center">There is no history</td>								
					</tr>
				</tbody>
			</table>
		</div>
	</div>


		
		</div>
	</div>	

	

	
			

	<!-- - - - - /COMPLAINT DETAIL - - - - -->

	<!-- - - - - COMPLAINT LOG - - - - -->
	
	
		
	<!-- - - - - /COMPLAINT LOG - - - - -->
</div>		
</uib-accordion>
