<style>
  	.total_count {
      	background-color: #2c3e50;
      	margin-bottom: 0px;
      	border-radius: 6px;
  	}

	.create_menu a {
		height: 0px;
		margin-top: -2px;
	}
	
</style>

<link rel="stylesheet" href="css/multi.css">


<script type="text/ng-template" id="complaint_reminder_dialog.html">
    <div ng-include="'tpl/complaint/complaint_reminder_dialog.html'"></div>
</script>

<div  ng-controller="DutyComplaintController" style="overflow: hidden">

	<!-- - - - - - - - - - - - - - - - - - - - - - - - HEADER - - - - - - - - - - - - - - - - - - - - - - - -->
	
	<div class="row bg-light lt" style="padding: 5px; margin-left: -10px;background-color: #141414">
    	<div class="col-sm-6"><h1 class="m-n font-thin h5 text-black" style="color:#337ab7">
					<label style="font-size: 25px; margin-bottom: 0px"><i class="fa fa-user-circle-o"></i>
	    	Duty Manager</label></h1>
			</div>
		<div class="input-group col-xs-2 pull-right" style="padding-right: 15px">
			<span ng-show="filter_value" class="input-group-btn">
                <button type="submit" class="btn btn-sm " ng-click="clearComplaint()"><i class="fa fa-close"></i></button>
            </span>	
	        <input type="text" ng-model="filter_value" class="form-control input-sm no-border  padder" ng-keyup="$event.keyCode == 13 && searchComplaint(filter_value)" placeholder="Guest/ID">
            <span class="input-group-btn">
                <button type="submit" class="btn btn-sm " ng-click="searchComplaint(filter_value)"><i class="fa fa-search"></i></button>
            </span>	          	
	    </div>
   	
	</div>
	
	<div class="hbox">
		<div class="col b-r" style="width: 45%; position: fixed">
			<!-- header -->
			<div class="wrapper bg-light lter b-b" style="padding-bottom:11px">
				<div class="btn-group pull-right">
					<button type="button" class="btn btn-sm btn-bg btn-default">
					  {{paginationOptions.numberOfPages}}/{{paginationOptions.countOfPages}} - {{paginationOptions.totalItems}} Items
					</button>
					<button type="button" class="btn btn-sm btn-bg btn-default" ng-click="onPrevPage()" ng-disabled="paginationOptions.numberOfPages <= 1">
						<i class="fa fa-chevron-left"></i>
					</button>
					<button type="button" class="btn btn-sm btn-bg btn-default" ng-click="onNextPage()"
						ng-disabled="paginationOptions.numberOfPages >= paginationOptions.countOfPages">
						<i class="fa fa-chevron-right"></i>
					</button>
			    </div>

			    <div class="btn-toolbar" style="padding-left: 2px">
			    	<div class="btn-group">
				    	<button class="btn btn-sm btn-icon btn-default" data-toggle="tooltip" title="Filter" data-placement="bottom" data-ng-click="openFilterPanel('left', true)">
							<i class="fa fa-filter"></i>
						</button>
					</div>						
					<div class="btn-group">
					  <button class="btn btn-sm btn-icon btn-default" data-toggle="tooltip" title="Refresh" data-placement="bottom" ng-click="refreshLogs()">
						<i class="fa fa-refresh"></i>
					  </button>
					</div>
					<button class="btn btn-sm btn-icon bg-wakeup-pending" data-toggle="tooltip" title="Pending" data-placement="bottom" ng-click="onFilter('Pending')" hidden>
						<i class="fa fa-inbox fa-fw"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-wakeup-success" data-toggle="tooltip" title="Resolved" data-placement="bottom" ng-click="onFilter('Resolved')" hidden>
						<i class="fa fa-check fa-fw"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-danger" data-toggle="tooltip" title="Rejected" data-placement="bottom" ng-click="onFilter('Rejected')" hidden>
						<i class="fa fa-times fa-fw"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-wakeup-waiting" data-toggle="tooltip" title="Acknowledge" data-placement="bottom" ng-click="onFilter('Acknowledge')" hidden>
						<i class="fa fa-handshake-o" aria-hidden="true"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-wakeup-in-progress" data-toggle="tooltip" title="Discussed" data-placement="bottom" ng-click="onFilter('Discussed')" hidden>
						<i class="fa fa-comments" aria-hidden="true"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-complaint-ack" data-toggle="tooltip" title="Flag" data-placement="bottom" ng-click="onFilter('Flag')" hidden>
						<i class="fa fa-flag" aria-hidden="true"></i>
					</button>
					<button class="btn btn-sm btn-icon bg-all" data-toggle="tooltip" title="Show All" data-placement="bottom" ng-click="onFilter('Total')" hidden>
						<i class=""></i><label><b>ALL</b></label>
					</button>
					<div class="btn-group pull-right" style="margin-right: 20px;margin-top: 5px;">
						<a ng-click="onDownloadPDF()">
							<i class="fa fa-file-pdf-o" style="font-size: 20px; color:red" aria-hidden="true" title="Summary PDF download"></i>
						</a>
					</div>
			  	</div>
			</div>
			<!-- / header -->
			<!-- Grid Table -->
			<div class="bg-light lter multiDemo" style="width:100%; padding: 0px; margin: 0px"
				ng-style="{'height': tab_height1, 'overflow-y': 'auto'}">
				<ul id="list_ticket" class="list-group list-group-lg no-radius table-striped m-b-none m-t-n-xxs" >
					<li ng-repeat="row in datalist" 
							class="list-group-item clearfix b-l-5x"
							ng-class="{'selected': row.active}"
							style="padding-bottom: 0px">
						<div class="pull-right text-muted" style="margin-top: 13px">
				      	</div>
						<div class="clear" ng-click="onSelectTicket(row, $index)" style="padding: 0px">				      
							<div class="clear">  
					    		<label class="font-bold"><a><i class="fa fa-id-badge" style="font-size: 17px; color: #1565C0"></i>&nbsp;{{::row.ticket_no}}</a></label>&nbsp;|
								<label><i class="fa text-info fa-home"></i>&nbsp;{{::row.shortcode}}</label>&nbsp;|
					    		<label><i class="fa fa-map-marker text-danger"></i> {{::row.lgm_type}} {{::row.lgm_name}} </label>&nbsp;
					    		<label ng-show="row.comp_total > 0 ">|&nbsp;<i class="fa fa-dollar text-success"></i> {{row.comp_total}} </label>
					    		<span class="label m-l-sm bg-update-warning" ng-if="!row.latest">
						    		New Update 
								</span>

								<span class="label m-l-sm" 
										ng-class="{'bg-info':$index == 0, 'bg-primary':$index == 1, 'bg-warning':$index == 2, 'bg-danger':$index == 3}" 
										ng-repeat="dept in row.dept_list | limitTo:4" >
						    		{{::dept.short_code}}
								</span>

								&nbsp;&nbsp;
					    		<label><i class="fa fa-clock-o"></i> {{::row.age_days}}</label>&nbsp;
																
					    		<label class="pull-right font-bold">
									<a class="text-sm" ng-click="flagComplaint(row);$event.stopPropagation();"><i class="fa fa-flag" ng-class="{'text-danger': row.flag == 1, 'text-mute': row.flag != 1}"></i>&nbsp;</a>
					    			<a class="text-sm">{{::row.created_at_time}}</a>
								</label>
							</div>
							
							<div class="text-ellipsis text-sm clear" style=" width: 100%; margin: 0px"> 
							    <i class="fa fa-user-circle-o" style="color: #00796B" ng-if="row.guest_type != 'House Complaint'"></i>
							    	<label ng-if="row.guest_type != 'House Complaint'">&nbsp;{{::row.guest_name}}&nbsp;|&nbsp;</label>
							    <i class="fa fa-male text-warning-dker" ng-if="row.guest_type == 'Walk-in' || row.guest_type == 'Arrival'"></i>
					    		<i class="fa fa-bank text-warning-dker" ng-if="row.guest_type == 'In-House'"></i>
					    		<i class="fa fa-bank text-warning-dker" ng-if="row.guest_type == 'Checkout'"></i>
					    		<i class="fa fa-home text-warning-dker" ng-if="row.guest_type == 'House Complaint'"></i>
					    			&nbsp;{{row.guest_type != 'House Complaint' ? row.guest_type : row.house_complaint_name}}{{row.guest_type == 'In-House' ? ' - ' + row.gs_guest_id : ''}}&nbsp;&nbsp;|
					    			&nbsp;<i class="fa fa-exclamation-triangle text-danger" ng-if="row.severity_name == 'Serious'"></i>
					    		<i class="fa fa-exclamation-circle text-danger" ng-if="row.severity_name == 'Major'"></i>
					    		<i class="fa fa-exclamation-circle text-warning-dker" ng-if="row.severity_name == 'Moderate'"></i>
					    		<i class="fa fa-exclamation-circle text-primary" ng-if="row.severity_name == 'Minor'"></i>
								<i class="fa fa-info-circle text-info" ng-if="row.severity_name == 'Informational'"></i>
								&nbsp;{{row.severity_name}}&nbsp;&nbsp;| &nbsp;
								<label ng-if="row.category_name"><i class="fa fa-bookmark text-danger"></i>&nbsp;&nbsp;{{::row.category_name}}&nbsp;&nbsp;|</label>&nbsp;
					    		<label class="text-default" ng-if="row.discussed_flag == 1" style="width: auto;
														  white-space: nowrap;
														  text-overflow: ellipsis;
														  text-overflow: ellipsis;
															-o-text-overflow: ellipsis">|&nbsp;
									<i class="fa fa-comments" style="color: #1B5E20"></i>{{::row.discuss_end_time_at}}
								</label>
					    		
							    <div class="pull-right" style="margin-right: 6px; margin-top: -1px">
							    	<span ng-if="row.closed_flag == 1" class="label m-l-sm bg-wakeup-success">
							    		Closed 
									</span>
							      	<span ng-class="{'label' : true, 'm-l-sm': true,
								    							'bg-wakeup-pending': row.status == 'Pending',
								    							'bg-wakeup-waiting': row.status == 'Acknowledge',
								    							'bg-wakeup-success': row.status == 'Resolved',
								    							'bg-wakeup-canceled': row.status == 'Rejected',
								    							'bg-wakeup-in-progress': row.status == 'Forwarded',	
								    							'bg-complaint-ack': row.status == 'Unresolved',
								    						}">{{row.status}}
									</span>
									<span ng-if="row.timeout_flag == 0 && row.escalation_flag == 1" ng-class="{'label' : true, 'm-l-sm': true,
								    							'bg-wakeup-waiting': row.escalation_flag == 1,								    							
								    						}">Escalated
									</span>
									<span ng-if="row.timeout_flag == 1" ng-class="{'label' : true, 'm-l-sm': true,
								    							'bg-wakeup-canceled': row.timeout_flag == 1,								    							
								    						}">Timeout
									</span>
								</div>
							</div>
							<div class="text-ellipsis text-sm" style="width: 100%; margin-top: 0px">
							    <label  style="width: 100%;
													  white-space: nowrap;
													  text-overflow: ellipsis;
													  overflow: hidden;
													  text-overflow: ellipsis;
														-o-text-overflow: ellipsis;">
														
									<i class="fa fa-commenting-o text-primary" aria-hidden="true"></i>&nbsp;<div style="display:inline-block;max-width:100px" ng-bind-html="row.comment"></div>
							  	</label>
							</div>  	
						
							<div class="text-ellipsis text-sm" style="width: 100%; margin-top: 0px">
							    <label  style="width: 70%;
													  white-space: nowrap;
													  text-overflow: ellipsis;
													  overflow: hidden;
													  text-overflow: ellipsis;
														-o-text-overflow: ellipsis;">
														
									<i class="fa fa-tags text-primary" aria-hidden="true" ng-show="row.send_flag==1"></i><span class="label m-l-sm"
								        
										ng-class="{'bg-default':$index == 0, 'bg-info':$index == 1, 'bg-warning':$index == 2, 'bg-danger':$index == 3, 'bg-wakeup-waiting':$index == 4, 'bg-primary':$index == 5}" 
										ng-repeat="depts in row.selected_ids | limitTo:11" >
						    		{{::depts.short_code}}
								</span>
							  	</label>
							  	<div ng-if="row.total > 0" class="text-ellipsis text-sm pull-right"
							      		style="font-size: 10px; width: 26%">
									<uib-progressbar class="progress-striped progress-sm" style="margin: 5px" value="getProcess(row)" type="info">									
									</uib-progressbar>		      											
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div class="col" style="width: 53.5%" ng-style="{'height': full_height, 'overflow-y': 'hidden'}">
			<div ng-if="!navflags" ng-cloak style="height: 44px">
				<md-content>
					<md-tabs md-selected="selectedIndex" md-autoselect md-dynamic-height md-border-bottom style="margin-left: -7px; height:40px;">
						<md-tab ng-repeat="tab in newTickets" style="margin:8px -5px 0px;" >
							<md-tab-label>
								<i class="fa fa-plus-square"></i>&nbsp;&nbsp;Create New
							</md-tab-label>
										
							<md-tab-body>
								<div fill-height additional-padding="50" debounce-wait="5" ng-controller="ComplaintDutyCreateController" ng-include="'tpl/complaint/complaint_duty_create.html'" ng-init="init('Acknowledge')">
								</div>
							</md-tab-body>
						</md-tab>
						
						<md-tab ng-repeat="tab in selectedTickets" style="margin:8px -5px 0px;">
							<md-tab-label>&nbsp;{{getTicketNumber(tab)}}
								<i class="fa fa-times" style="margin-left: 5px; color:#FF0000" ng-click="onSelectTicket(tab)"></i>
							</md-tab-label>
										
							<md-tab-body>
								<div ng-controller="ComplaintDutyValidationController" ng-include="'tpl/complaint/complaint_duty_validate.html'" ng-init="init(tab)">
								</div>
							</md-tab-body>
						</md-tab>
					</md-tabs>
				</md-content>
			</div>

			<uib-tabset ng-if="navflags" active="active">
				<div class="tabs tabs-style-tzoid" style="height: 44px">
					<nav ui-nav class="call_menu navi clearfix">
						<ul class="tabs-style-tzoid nav" style="margin-left: 0; height:40px;">
							<li ng-repeat="tab in newTickets" style="margin:8px -5px 0px;" class="{{active == 1 ? 'tab-current' : ''}}">
								<uib-tab index="1">
									<uib-tab-heading>
										<div class="form-group" style="color:#fff; font-size:12px; margin-left: 0px" ng-controller="ComplaintDutyValidationController" ng-init="getParam()">
											<label class="font-bold tabs-style-tzoid">
												<i class="fa fa-plus-square"></i>&nbsp;&nbsp;Create New
											</label>
										</div>
									</uib-tab-heading>
									<div fill-height additional-padding="50" debounce-wait="5" ng-controller="ComplaintDutyCreateController" ng-include="'tpl/complaint/complaint_duty_create.html'" ng-init="init('Acknowledge')">
									</div>
								</uib-tab>
							</li>
							<li ng-repeat="tab in selectedTickets" style="margin:8px -5px 0px;" class="{{active == tab.id + 6 ? 'tab-current' : ''}}">
								<uib-tab index="tab.id + 6">
									<uib-tab-heading>
										<div class="form-group" style="color:#fff; font-size:12px">
											<label class="tabs-style-tzoid">&nbsp;{{getTicketNumber(tab)}}
												<i class="fa fa-times" style="margin-left: 5px; color:#FF0000" ng-click="onSelectTicket(tab)"></i>
											</label>
										</div>
									</uib-tab-heading>
									<div fill-height additional-padding="50" debounce-wait="10" ng-controller="ComplaintDutyValidationController" ng-include="'tpl/complaint/complaint_duty_validate.html'" ng-init="init(tab)">
									</div>
								</uib-tab>
							</li>
						</ul>
					</nav>
				</div>
			</uib-tabset>
		</div>
	</div>
</div>
